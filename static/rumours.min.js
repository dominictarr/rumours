(function(){var require=function(file,cwd){var resolved=require.resolve(file,cwd||"/");var mod=require.modules[resolved];if(!mod)throw new Error("Failed to resolve module "+file+", tried "+resolved);var cached=require.cache[resolved];var res=cached?cached.exports:mod();return res};require.paths=[];require.modules={};require.cache={};require.extensions=[".js",".coffee",".json"];require._core={assert:true,events:true,fs:true,path:true,vm:true};require.resolve=function(){return function(x,cwd){if(!cwd)cwd="/";if(require._core[x])return x;var path=require.modules.path();cwd=path.resolve("/",cwd);var y=cwd||"/";if(x.match(/^(?:\.\.?\/|\/)/)){var m=loadAsFileSync(path.resolve(y,x))||loadAsDirectorySync(path.resolve(y,x));if(m)return m}var n=loadNodeModulesSync(x,y);if(n)return n;throw new Error("Cannot find module '"+x+"'");function loadAsFileSync(x){x=path.normalize(x);if(require.modules[x]){return x}for(var i=0;i<require.extensions.length;i++){var ext=require.extensions[i];if(require.modules[x+ext])return x+ext}}function loadAsDirectorySync(x){x=x.replace(/\/+$/,"");var pkgfile=path.normalize(x+"/package.json");if(require.modules[pkgfile]){var pkg=require.modules[pkgfile]();var b=pkg.browserify;if(typeof b==="object"&&b.main){var m=loadAsFileSync(path.resolve(x,b.main));if(m)return m}else if(typeof b==="string"){var m=loadAsFileSync(path.resolve(x,b));if(m)return m}else if(pkg.main){var m=loadAsFileSync(path.resolve(x,pkg.main));if(m)return m}}return loadAsFileSync(x+"/index")}function loadNodeModulesSync(x,start){var dirs=nodeModulesPathsSync(start);for(var i=0;i<dirs.length;i++){var dir=dirs[i];var m=loadAsFileSync(dir+"/"+x);if(m)return m;var n=loadAsDirectorySync(dir+"/"+x);if(n)return n}var m=loadAsFileSync(x);if(m)return m}function nodeModulesPathsSync(start){var parts;if(start==="/")parts=[""];else parts=path.normalize(start).split("/");var dirs=[];for(var i=parts.length-1;i>=0;i--){if(parts[i]==="node_modules")continue;var dir=parts.slice(0,i+1).join("/")+"/node_modules";dirs.push(dir)}return dirs}}}();require.alias=function(from,to){var path=require.modules.path();var res=null;try{res=require.resolve(from+"/package.json","/")}catch(err){res=require.resolve(from,"/")}var basedir=path.dirname(res);var keys=(Object.keys||function(obj){var res=[];for(var key in obj)res.push(key);return res})(require.modules);for(var i=0;i<keys.length;i++){var key=keys[i];if(key.slice(0,basedir.length+1)===basedir+"/"){var f=key.slice(basedir.length);require.modules[to+f]=require.modules[basedir+f]}else if(key===basedir){require.modules[to]=require.modules[basedir]}}};(function(){var process={};var global=typeof window!=="undefined"?window:{};var definedProcess=false;require.define=function(filename,fn){if(!definedProcess&&require.modules.__browserify_process){process=require.modules.__browserify_process();definedProcess=true}var dirname=require._core[filename]?"":require.modules.path().dirname(filename);var require_=function(file){var requiredModule=require(file,dirname);var cached=require.cache[require.resolve(file,dirname)];if(cached&&cached.parent===null){cached.parent=module_}return requiredModule};require_.resolve=function(name){return require.resolve(name,dirname)};require_.modules=require.modules;require_.define=require.define;require_.cache=require.cache;var module_={id:filename,filename:filename,exports:{},loaded:false,parent:null};require.modules[filename]=function(){require.cache[filename]=module_;fn.call(module_.exports,require_,module_,module_.exports,dirname,filename,process,global);module_.loaded=true;return module_.exports}}})();require.define("path",function(require,module,exports,__dirname,__filename,process,global){function filter(xs,fn){var res=[];for(var i=0;i<xs.length;i++){if(fn(xs[i],i,xs))res.push(xs[i])}return res}function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length;i>=0;i--){var last=parts[i];if(last=="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"||!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=path.charAt(0)==="/",trailingSlash=path.slice(-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){return p&&typeof p==="string"}).join("/"))};exports.dirname=function(path){var dir=splitPathRe.exec(path)[1]||"";var isWindows=false;if(!dir){return"."}else if(dir.length===1||isWindows&&dir.length<=3&&dir.charAt(1)===":"){return dir}else{return dir.substring(0,dir.length-1)}};exports.basename=function(path,ext){var f=splitPathRe.exec(path)[2]||"";if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPathRe.exec(path)[3]||""}});require.define("__browserify_process",function(require,module,exports,__dirname,__filename,process,global){var process=module.exports={};process.nextTick=function(){var canSetImmediate=typeof window!=="undefined"&&window.setImmediate;var canPost=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(canSetImmediate){return function(f){return window.setImmediate(f)}}if(canPost){var queue=[];window.addEventListener("message",function(ev){if(ev.source===window&&ev.data==="browserify-tick"){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}},true);return function nextTick(fn){queue.push(fn);window.postMessage("browserify-tick","*")}}return function nextTick(fn){setTimeout(fn,0)}}();process.title="browser";process.browser=true;process.env={};process.argv=[];process.binding=function(name){if(name==="evals")return require("vm");else throw new Error("No such module. (Possibly not yet loaded)")};(function(){var cwd="/";var path;process.cwd=function(){return cwd};process.chdir=function(dir){if(!path)path=require("path");cwd=path.resolve(dir,cwd)}})()});require.define("/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={main:"./server.js",browserify:"./client.js"}});require.define("/client.js",function(require,module,exports,__dirname,__filename,process,global){var reconnect=require("reconnect");var reloader=require("client-reloader");var Remote=require("level-scuttlebutt/client");module.exports=function(config){config=config||{};var udid=require("udid")(config.name||"rumours");var host=config.host||window.location.protocol+"//"+window.location.host;config.name=config.name||"rumours";config.prefix=config.prefix||"/rumours";var schema=config.schema||require("./schema");var remote=Remote(schema);var r=reconnect(reloader(function(stream){stream.pipe(remote.createRemoteStream()).pipe(stream)},config)).connect(host+config.prefix);r.open=remote.open;r.view=remote.view;return r}});require.define("/node_modules/reconnect/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={browserify:"./shoe"}});require.define("/node_modules/reconnect/shoe.js",function(require,module,exports,__dirname,__filename,process,global){var shoe=require("shoe");module.exports=require("./inject")(function(){var args=[].slice.call(arguments);return shoe.apply(null,args)})});require.define("/node_modules/shoe/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={main:"index.js",browserify:"browser.js"}});require.define("/node_modules/shoe/browser.js",function(require,module,exports,__dirname,__filename,process,global){var Stream=require("stream");var sockjs=require("sockjs-client");module.exports=function(uri,cb){if(/^\/\/[^\/]+\//.test(uri)){uri=window.location.protocol+uri}else if(!/^https?:\/\//.test(uri)){uri=window.location.protocol+"//"+window.location.host+(/^\//.test(uri)?uri:"/"+uri)}var stream=new Stream;stream.readable=true;stream.writable=true;var ready=false;var buffer=[];var sock=sockjs(uri);stream.sock=sock;stream.write=function(msg){if(!ready||buffer.length)buffer.push(msg);else sock.send(msg)};stream.end=function(msg){if(msg!==undefined)stream.write(msg);if(!ready){stream._ended=true;return}stream.writable=false;sock.close()};stream.destroy=function(){stream._ended=true;stream.writable=stream.readable=false;buffer.length=0;sock.close()};sock.onopen=function(){if(typeof cb==="function")cb();ready=true;buffer.forEach(function(msg){sock.send(msg)});buffer=[];stream.emit("connect");if(stream._ended)stream.end()};sock.onmessage=function(e){stream.emit("data",e.data)};sock.onclose=function(){stream.emit("end");stream.writable=false;stream.readable=false};return stream}});require.define("stream",function(require,module,exports,__dirname,__filename,process,global){var events=require("events");var util=require("util");function Stream(){events.EventEmitter.call(this)}util.inherits(Stream,events.EventEmitter);module.exports=Stream;Stream.Stream=Stream;Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(false===dest.write(chunk)&&source.pause){source.pause()}}}source.on("data",ondata);function ondrain(){if(source.readable&&source.resume){source.resume()}}dest.on("drain",ondrain);if(!dest._isStdio&&(!options||options.end!==false)){dest._pipeCount=dest._pipeCount||0;dest._pipeCount++;source.on("end",onend);source.on("close",onclose)}var didOnEnd=false;function onend(){if(didOnEnd)return;didOnEnd=true;dest._pipeCount--;cleanup();if(dest._pipeCount>0){return}dest.end()}function onclose(){if(didOnEnd)return;didOnEnd=true;dest._pipeCount--;cleanup();if(dest._pipeCount>0){return}dest.destroy()}function onerror(er){cleanup();if(this.listeners("error").length===0){throw er}}source.on("error",onerror);dest.on("error",onerror);function cleanup(){source.removeListener("data",ondata);dest.removeListener("drain",ondrain);source.removeListener("end",onend);source.removeListener("close",onclose);source.removeListener("error",onerror);dest.removeListener("error",onerror);source.removeListener("end",cleanup);source.removeListener("close",cleanup);dest.removeListener("end",cleanup);dest.removeListener("close",cleanup)}source.on("end",cleanup);source.on("close",cleanup);dest.on("end",cleanup);dest.on("close",cleanup);dest.emit("pipe",source);return dest}});require.define("events",function(require,module,exports,__dirname,__filename,process,global){if(!process.EventEmitter)process.EventEmitter=function(){};var EventEmitter=exports.EventEmitter=process.EventEmitter;var isArray=typeof Array.isArray==="function"?Array.isArray:function(xs){return Object.prototype.toString.call(xs)==="[object Array]"};function indexOf(xs,x){if(xs.indexOf)return xs.indexOf(x);for(var i=0;i<xs.length;i++){if(x===xs[i])return i}return-1}var defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!this._events)this._events={};this._events.maxListeners=n};EventEmitter.prototype.emit=function(type){if(type==="error"){if(!this._events||!this._events.error||isArray(this._events.error)&&!this._events.error.length){if(arguments[1]instanceof Error){throw arguments[1]}else{throw new Error("Uncaught, unspecified 'error' event.")}return false}}if(!this._events)return false;var handler=this._events[type];if(!handler)return false;if(typeof handler=="function"){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:var args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}return true}else if(isArray(handler)){var args=Array.prototype.slice.call(arguments,1);var listeners=handler.slice();for(var i=0,l=listeners.length;i<l;i++){listeners[i].apply(this,args)}return true}else{return false}};EventEmitter.prototype.addListener=function(type,listener){if("function"!==typeof listener){throw new Error("addListener only takes instances of Function")}if(!this._events)this._events={};this.emit("newListener",type,listener);if(!this._events[type]){this._events[type]=listener}else if(isArray(this._events[type])){if(!this._events[type].warned){var m;if(this._events.maxListeners!==undefined){m=this._events.maxListeners}else{m=defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);console.trace()}}this._events[type].push(listener)}else{this._events[type]=[this._events[type],listener]}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){var self=this;self.on(type,function g(){self.removeListener(type,g);listener.apply(this,arguments)});return this};EventEmitter.prototype.removeListener=function(type,listener){if("function"!==typeof listener){throw new Error("removeListener only takes instances of Function")}if(!this._events||!this._events[type])return this;var list=this._events[type];if(isArray(list)){var i=indexOf(list,listener);if(i<0)return this;list.splice(i,1);if(list.length==0)delete this._events[type]}else if(this._events[type]===listener){delete this._events[type]}return this};EventEmitter.prototype.removeAllListeners=function(type){if(type&&this._events&&this._events[type])this._events[type]=null;return this};EventEmitter.prototype.listeners=function(type){if(!this._events)this._events={};if(!this._events[type])this._events[type]=[];if(!isArray(this._events[type])){this._events[type]=[this._events[type]]}return this._events[type]}});require.define("util",function(require,module,exports,__dirname,__filename,process,global){var events=require("events");exports.isArray=isArray;exports.isDate=function(obj){return Object.prototype.toString.call(obj)==="[object Date]"};exports.isRegExp=function(obj){return Object.prototype.toString.call(obj)==="[object RegExp]"};exports.print=function(){};exports.puts=function(){};exports.debug=function(){};exports.inspect=function(obj,showHidden,depth,colors){var seen=[];var stylize=function(str,styleType){var styles={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};var style={special:"cyan",number:"blue","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"}[styleType];if(style){return"["+styles[style][0]+"m"+str+"["+styles[style][1]+"m"}else{return str}};if(!colors){stylize=function(str,styleType){return str}}function format(value,recurseTimes){if(value&&typeof value.inspect==="function"&&value!==exports&&!(value.constructor&&value.constructor.prototype===value)){return value.inspect(recurseTimes)}switch(typeof value){case"undefined":return stylize("undefined","undefined");case"string":var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return stylize(simple,"string");case"number":return stylize(""+value,"number");case"boolean":return stylize(""+value,"boolean")}if(value===null){return stylize("null","null")}var visible_keys=Object_keys(value);var keys=showHidden?Object_getOwnPropertyNames(value):visible_keys;if(typeof value==="function"&&keys.length===0){if(isRegExp(value)){return stylize(""+value,"regexp")}else{var name=value.name?": "+value.name:"";return stylize("[Function"+name+"]","special")}}if(isDate(value)&&keys.length===0){return stylize(value.toUTCString(),"date")}var base,type,braces;if(isArray(value)){type="Array";braces=["[","]"]}else{type="Object";braces=["{","}"]}if(typeof value==="function"){var n=value.name?": "+value.name:"";base=isRegExp(value)?" "+value:" [Function"+n+"]"}else{base=""}if(isDate(value)){base=" "+value.toUTCString()}if(keys.length===0){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return stylize(""+value,"regexp")}else{return stylize("[Object]","special")}}seen.push(value);var output=keys.map(function(key){var name,str;if(value.__lookupGetter__){if(value.__lookupGetter__(key)){if(value.__lookupSetter__(key)){str=stylize("[Getter/Setter]","special")}else{str=stylize("[Getter]","special")}}else{if(value.__lookupSetter__(key)){str=stylize("[Setter]","special")}}}if(visible_keys.indexOf(key)<0){name="["+key+"]"}if(!str){if(seen.indexOf(value[key])<0){if(recurseTimes===null){str=format(value[key])}else{str=format(value[key],recurseTimes-1)}if(str.indexOf("\n")>-1){if(isArray(value)){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=stylize("[Circular]","special")}}if(typeof name==="undefined"){if(type==="Array"&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=stylize(name,"string")}}return name+": "+str});seen.pop();var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.length+1},0);if(length>50){output=braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}else{output=braces[0]+base+" "+output.join(", ")+" "+braces[1]}return output}return format(obj,typeof depth==="undefined"?2:depth)};function isArray(ar){return ar instanceof Array||Array.isArray(ar)||ar&&ar!==Object.prototype&&isArray(ar.__proto__)}function isRegExp(re){return re instanceof RegExp||typeof re==="object"&&Object.prototype.toString.call(re)==="[object RegExp]"}function isDate(d){if(d instanceof Date)return true;if(typeof d!=="object")return false;var properties=Date.prototype&&Object_getOwnPropertyNames(Date.prototype);var proto=d.__proto__&&Object_getOwnPropertyNames(d.__proto__);return JSON.stringify(proto)===JSON.stringify(properties)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(msg){};exports.pump=null;var Object_keys=Object.keys||function(obj){var res=[];for(var key in obj)res.push(key);return res};var Object_getOwnPropertyNames=Object.getOwnPropertyNames||function(obj){var res=[];for(var key in obj){if(Object.hasOwnProperty.call(obj,key))res.push(key)}return res};var Object_create=Object.create||function(prototype,properties){var object;if(prototype===null){object={__proto__:null}}else{if(typeof prototype!=="object"){throw new TypeError("typeof prototype["+typeof prototype+"] != 'object'")}var Type=function(){};Type.prototype=prototype;object=new Type;object.__proto__=prototype}if(typeof properties!=="undefined"&&Object.defineProperties){Object.defineProperties(object,properties)}return object};exports.inherits=function(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object_create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})};var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(typeof f!=="string"){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(exports.inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":return JSON.stringify(args[i++]);default:return x}});for(var x=args[i];i<len;x=args[++i]){if(x===null||typeof x!=="object"){str+=" "+x}else{str+=" "+exports.inspect(x)}}return str}});require.define("/node_modules/shoe/node_modules/sockjs-client/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={main:"sockjs.js"}});require.define("/node_modules/shoe/node_modules/sockjs-client/sockjs.js",function(require,module,exports,__dirname,__filename,process,global){var JSON;JSON||(JSON={}),function(){function str(a,b){var c,d,e,f,g=gap,h,i=b[a];i&&typeof i=="object"&&typeof i.toJSON=="function"&&(i=i.toJSON(a)),typeof rep=="function"&&(i=rep.call(b,a,i));switch(typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";gap+=indent,h=[];if(Object.prototype.toString.apply(i)==="[object Array]"){f=i.length;for(c=0;c<f;c+=1)h[c]=str(c,i)||"null";e=h.length===0?"[]":gap?"[\n"+gap+h.join(",\n"+gap)+"\n"+g+"]":"["+h.join(",")+"]",gap=g;return e}if(rep&&typeof rep=="object"){f=rep.length;for(c=0;c<f;c+=1)typeof rep[c]=="string"&&(d=rep[c],e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e))}else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e));e=h.length===0?"{}":gap?"{\n"+gap+h.join(",\n"+gap)+"\n"+g+"}":"{"+h.join(",")+"}",gap=g;return e}}function quote(a){escapable.lastIndex=0;return escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return typeof b=="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function f(a){return a<10?"0"+a:a}"use strict",typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(a,b,c){var d;gap="",indent="";if(typeof c=="number")for(d=0;d<c;d+=1)indent+=" ";else typeof c=="string"&&(indent=c);rep=b;if(!b||typeof b=="function"||typeof b=="object"&&typeof b.length=="number")return str("",{"":a});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e=="object")for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),d!==undefined?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver=="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")})}();var SockJS=function(){var _document=document;var _window=window;var utils={};var REventTarget=function(){};REventTarget.prototype.addEventListener=function(eventType,listener){if(!this._listeners){this._listeners={}}if(!(eventType in this._listeners)){this._listeners[eventType]=[]}var arr=this._listeners[eventType];if(utils.arrIndexOf(arr,listener)===-1){arr.push(listener)}return};REventTarget.prototype.removeEventListener=function(eventType,listener){if(!(this._listeners&&eventType in this._listeners)){return}var arr=this._listeners[eventType];var idx=utils.arrIndexOf(arr,listener);if(idx!==-1){if(arr.length>1){this._listeners[eventType]=arr.slice(0,idx).concat(arr.slice(idx+1))}else{delete this._listeners[eventType]}return}return};REventTarget.prototype.dispatchEvent=function(event){var t=event.type;var args=Array.prototype.slice.call(arguments,0);if(this["on"+t]){this["on"+t].apply(this,args)}if(this._listeners&&t in this._listeners){for(var i=0;i<this._listeners[t].length;i++){this._listeners[t][i].apply(this,args)}}};var SimpleEvent=function(type,obj){this.type=type;if(typeof obj!=="undefined"){for(var k in obj){if(!obj.hasOwnProperty(k))continue;this[k]=obj[k]}}};SimpleEvent.prototype.toString=function(){var r=[];for(var k in this){if(!this.hasOwnProperty(k))continue;var v=this[k];if(typeof v==="function")v="[function]";r.push(k+"="+v)}return"SimpleEvent("+r.join(", ")+")"};var EventEmitter=function(events){this.events=events||[]};EventEmitter.prototype.emit=function(type){var that=this;var args=Array.prototype.slice.call(arguments,1);if(!that.nuked&&that["on"+type]){that["on"+type].apply(that,args)}if(utils.arrIndexOf(that.events,type)===-1){utils.log("Event "+JSON.stringify(type)+" not listed "+JSON.stringify(that.events)+" in "+that)}};EventEmitter.prototype.nuke=function(type){var that=this;that.nuked=true;for(var i=0;i<that.events.length;i++){delete that[that.events[i]]}};var random_string_chars="abcdefghijklmnopqrstuvwxyz0123456789_";utils.random_string=function(length,max){max=max||random_string_chars.length;var i,ret=[];for(i=0;i<length;i++){ret.push(random_string_chars.substr(Math.floor(Math.random()*max),1))}return ret.join("")};utils.random_number=function(max){return Math.floor(Math.random()*max)};utils.random_number_string=function(max){var t=(""+(max-1)).length;var p=Array(t+1).join("0");return(p+utils.random_number(max)).slice(-t)};utils.getOrigin=function(url){url+="/";var parts=url.split("/").slice(0,3);return parts.join("/")};utils.isSameOriginUrl=function(url_a,url_b){if(!url_b)url_b=_window.location.href;return url_a.split("/").slice(0,3).join("/")===url_b.split("/").slice(0,3).join("/")};utils.getParentDomain=function(url){if(/^[0-9.]*$/.test(url))return url;if(/^\[/.test(url))return url;if(!/[.]/.test(url))return url;var parts=url.split(".").slice(1);return parts.join(".")};utils.objectExtend=function(dst,src){for(var k in src){if(src.hasOwnProperty(k)){dst[k]=src[k]}}return dst};var WPrefix="_jp";utils.polluteGlobalNamespace=function(){if(!(WPrefix in _window)){_window[WPrefix]={}}};utils.closeFrame=function(code,reason){return"c"+JSON.stringify([code,reason])};utils.userSetCode=function(code){return code===1e3||code>=3e3&&code<=4999};utils.countRTO=function(rtt){var rto;if(rtt>100){rto=3*rtt}else{rto=rtt+200}return rto};utils.log=function(){if(_window.console&&console.log&&console.log.apply){console.log.apply(console,arguments)}};utils.bind=function(fun,that){if(fun.bind){return fun.bind(that)}else{return function(){return fun.apply(that,arguments)}}};utils.flatUrl=function(url){return url.indexOf("?")===-1&&url.indexOf("#")===-1};utils.amendUrl=function(url){var dl=_document.location;if(!url){throw new Error("Wrong url for SockJS")}if(!utils.flatUrl(url)){throw new Error("Only basic urls are supported in SockJS")}if(url.indexOf("//")===0){url=dl.protocol+url}if(url.indexOf("/")===0){url=dl.protocol+"//"+dl.host+url}url=url.replace(/[/]+$/,"");return url};utils.arrIndexOf=function(arr,obj){for(var i=0;i<arr.length;i++){if(arr[i]===obj){return i}}return-1};utils.arrSkip=function(arr,obj){var idx=utils.arrIndexOf(arr,obj);if(idx===-1){return arr.slice()}else{var dst=arr.slice(0,idx);return dst.concat(arr.slice(idx+1))}};utils.isArray=Array.isArray||function(value){return{}.toString.call(value).indexOf("Array")>=0};utils.delay=function(t,fun){if(typeof t==="function"){fun=t;t=0}return setTimeout(fun,t)};var json_escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,json_lookup={"\0":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","	":"\\t","\n":"\\n","":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","":"\\u0080","":"\\u0081","":"\\u0082","":"\\u0083","":"\\u0084","":"\\u0085","":"\\u0086","":"\\u0087","":"\\u0088","":"\\u0089","":"\\u008a","":"\\u008b","":"\\u008c","":"\\u008d","":"\\u008e","":"\\u008f","":"\\u0090","":"\\u0091","":"\\u0092","":"\\u0093","":"\\u0094","":"\\u0095","":"\\u0096","":"\\u0097","":"\\u0098","":"\\u0099","":"\\u009a","":"\\u009b","":"\\u009c","":"\\u009d","":"\\u009e","":"\\u009f","­":"\\u00ad","؀":"\\u0600","؁":"\\u0601","؂":"\\u0602","؃":"\\u0603","؄":"\\u0604","܏":"\\u070f","឴":"\\u17b4","឵":"\\u17b5","‌":"\\u200c","‍":"\\u200d","‎":"\\u200e","‏":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","‪":"\\u202a","‫":"\\u202b","‬":"\\u202c","‭":"\\u202d","‮":"\\u202e"," ":"\\u202f","⁠":"\\u2060","⁡":"\\u2061","⁢":"\\u2062","⁣":"\\u2063","⁤":"\\u2064","⁥":"\\u2065","⁦":"\\u2066","⁧":"\\u2067","⁨":"\\u2068","⁩":"\\u2069","⁪":"\\u206a","⁫":"\\u206b","⁬":"\\u206c","⁭":"\\u206d","⁮":"\\u206e","⁯":"\\u206f","﻿":"\\ufeff","￰":"\\ufff0","￱":"\\ufff1","￲":"\\ufff2","￳":"\\ufff3","￴":"\\ufff4","￵":"\\ufff5","￶":"\\ufff6","￷":"\\ufff7","￸":"\\ufff8","￹":"\\ufff9","￺":"\\ufffa","￻":"\\ufffb","￼":"\\ufffc","�":"\\ufffd","￾":"\\ufffe","￿":"\\uffff"};var extra_escapable=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,extra_lookup;var JSONQuote=JSON&&JSON.stringify||function(string){json_escapable.lastIndex=0;if(json_escapable.test(string)){string=string.replace(json_escapable,function(a){return json_lookup[a]})}return'"'+string+'"'};var unroll_lookup=function(escapable){var i;var unrolled={};var c=[];for(i=0;i<65536;i++){c.push(String.fromCharCode(i))}escapable.lastIndex=0;c.join("").replace(escapable,function(a){unrolled[a]="\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);return""});escapable.lastIndex=0;return unrolled};utils.quote=function(string){var quoted=JSONQuote(string);extra_escapable.lastIndex=0;if(!extra_escapable.test(quoted)){return quoted}if(!extra_lookup)extra_lookup=unroll_lookup(extra_escapable);return quoted.replace(extra_escapable,function(a){return extra_lookup[a]})};var _all_protocols=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];
utils.probeProtocols=function(){var probed={};for(var i=0;i<_all_protocols.length;i++){var protocol=_all_protocols[i];probed[protocol]=SockJS[protocol]&&SockJS[protocol].enabled()}return probed};utils.detectProtocols=function(probed,protocols_whitelist,info){var pe={},protocols=[];if(!protocols_whitelist)protocols_whitelist=_all_protocols;for(var i=0;i<protocols_whitelist.length;i++){var protocol=protocols_whitelist[i];pe[protocol]=probed[protocol]}var maybe_push=function(protos){var proto=protos.shift();if(pe[proto]){protocols.push(proto)}else{if(protos.length>0){maybe_push(protos)}}};if(info.websocket!==false){maybe_push(["websocket"])}if(pe["xhr-streaming"]&&!info.null_origin){protocols.push("xhr-streaming")}else{if(pe["xdr-streaming"]&&!info.cookie_needed&&!info.null_origin){protocols.push("xdr-streaming")}else{maybe_push(["iframe-eventsource","iframe-htmlfile"])}}if(pe["xhr-polling"]&&!info.null_origin){protocols.push("xhr-polling")}else{if(pe["xdr-polling"]&&!info.cookie_needed&&!info.null_origin){protocols.push("xdr-polling")}else{maybe_push(["iframe-xhr-polling","jsonp-polling"])}}return protocols};var MPrefix="_sockjs_global";utils.createHook=function(){var window_id="a"+utils.random_string(8);if(!(MPrefix in _window)){var map={};_window[MPrefix]=function(window_id){if(!(window_id in map)){map[window_id]={id:window_id,del:function(){delete map[window_id]}}}return map[window_id]}}return _window[MPrefix](window_id)};utils.attachMessage=function(listener){utils.attachEvent("message",listener)};utils.attachEvent=function(event,listener){if(typeof _window.addEventListener!=="undefined"){_window.addEventListener(event,listener,false)}else{_document.attachEvent("on"+event,listener);_window.attachEvent("on"+event,listener)}};utils.detachMessage=function(listener){utils.detachEvent("message",listener)};utils.detachEvent=function(event,listener){if(typeof _window.addEventListener!=="undefined"){_window.removeEventListener(event,listener,false)}else{_document.detachEvent("on"+event,listener);_window.detachEvent("on"+event,listener)}};var on_unload={};var after_unload=false;var trigger_unload_callbacks=function(){for(var ref in on_unload){on_unload[ref]();delete on_unload[ref]}};var unload_triggered=function(){if(after_unload)return;after_unload=true;trigger_unload_callbacks()};utils.attachEvent("beforeunload",unload_triggered);utils.attachEvent("unload",unload_triggered);utils.unload_add=function(listener){var ref=utils.random_string(8);on_unload[ref]=listener;if(after_unload){utils.delay(trigger_unload_callbacks)}return ref};utils.unload_del=function(ref){if(ref in on_unload)delete on_unload[ref]};utils.createIframe=function(iframe_url,error_callback){var iframe=_document.createElement("iframe");var tref,unload_ref;var unattach=function(){clearTimeout(tref);try{iframe.onload=null}catch(x){}iframe.onerror=null};var cleanup=function(){if(iframe){unattach();setTimeout(function(){if(iframe){iframe.parentNode.removeChild(iframe)}iframe=null},0);utils.unload_del(unload_ref)}};var onerror=function(r){if(iframe){cleanup();error_callback(r)}};var post=function(msg,origin){try{if(iframe&&iframe.contentWindow){iframe.contentWindow.postMessage(msg,origin)}}catch(x){}};iframe.src=iframe_url;iframe.style.display="none";iframe.style.position="absolute";iframe.onerror=function(){onerror("onerror")};iframe.onload=function(){clearTimeout(tref);tref=setTimeout(function(){onerror("onload timeout")},2e3)};_document.body.appendChild(iframe);tref=setTimeout(function(){onerror("timeout")},15e3);unload_ref=utils.unload_add(cleanup);return{post:post,cleanup:cleanup,loaded:unattach}};utils.createHtmlfile=function(iframe_url,error_callback){var doc=new ActiveXObject("htmlfile");var tref,unload_ref;var iframe;var unattach=function(){clearTimeout(tref)};var cleanup=function(){if(doc){unattach();utils.unload_del(unload_ref);iframe.parentNode.removeChild(iframe);iframe=doc=null;CollectGarbage()}};var onerror=function(r){if(doc){cleanup();error_callback(r)}};var post=function(msg,origin){try{if(iframe&&iframe.contentWindow){iframe.contentWindow.postMessage(msg,origin)}}catch(x){}};doc.open();doc.write("<html><s"+"cript>"+'document.domain="'+document.domain+'";'+"</s"+"cript></html>");doc.close();doc.parentWindow[WPrefix]=_window[WPrefix];var c=doc.createElement("div");doc.body.appendChild(c);iframe=doc.createElement("iframe");c.appendChild(iframe);iframe.src=iframe_url;tref=setTimeout(function(){onerror("timeout")},15e3);unload_ref=utils.unload_add(cleanup);return{post:post,cleanup:cleanup,loaded:unattach}};var AbstractXHRObject=function(){};AbstractXHRObject.prototype=new EventEmitter(["chunk","finish"]);AbstractXHRObject.prototype._start=function(method,url,payload,opts){var that=this;try{that.xhr=new XMLHttpRequest}catch(x){}if(!that.xhr){try{that.xhr=new _window.ActiveXObject("Microsoft.XMLHTTP")}catch(x){}}if(_window.ActiveXObject||_window.XDomainRequest){url+=(url.indexOf("?")===-1?"?":"&")+"t="+ +new Date}that.unload_ref=utils.unload_add(function(){that._cleanup(true)});try{that.xhr.open(method,url,true)}catch(e){that.emit("finish",0,"");that._cleanup();return}if(!opts||!opts.no_credentials){that.xhr.withCredentials="true"}if(opts&&opts.headers){for(var key in opts.headers){that.xhr.setRequestHeader(key,opts.headers[key])}}that.xhr.onreadystatechange=function(){if(that.xhr){var x=that.xhr;switch(x.readyState){case 3:try{var status=x.status;var text=x.responseText}catch(x){};if(text&&text.length>0){that.emit("chunk",status,text)}break;case 4:that.emit("finish",x.status,x.responseText);that._cleanup(false);break}}};that.xhr.send(payload)};AbstractXHRObject.prototype._cleanup=function(abort){var that=this;if(!that.xhr)return;utils.unload_del(that.unload_ref);that.xhr.onreadystatechange=function(){};if(abort){try{that.xhr.abort()}catch(x){}}that.unload_ref=that.xhr=null};AbstractXHRObject.prototype.close=function(){var that=this;that.nuke();that._cleanup(true)};var XHRCorsObject=utils.XHRCorsObject=function(){var that=this,args=arguments;utils.delay(function(){that._start.apply(that,args)})};XHRCorsObject.prototype=new AbstractXHRObject;var XHRLocalObject=utils.XHRLocalObject=function(method,url,payload){var that=this;utils.delay(function(){that._start(method,url,payload,{no_credentials:true})})};XHRLocalObject.prototype=new AbstractXHRObject;var XDRObject=utils.XDRObject=function(method,url,payload){var that=this;utils.delay(function(){that._start(method,url,payload)})};XDRObject.prototype=new EventEmitter(["chunk","finish"]);XDRObject.prototype._start=function(method,url,payload){var that=this;var xdr=new XDomainRequest;url+=(url.indexOf("?")===-1?"?":"&")+"t="+ +new Date;var onerror=xdr.ontimeout=xdr.onerror=function(){that.emit("finish",0,"");that._cleanup(false)};xdr.onprogress=function(){that.emit("chunk",200,xdr.responseText)};xdr.onload=function(){that.emit("finish",200,xdr.responseText);that._cleanup(false)};that.xdr=xdr;that.unload_ref=utils.unload_add(function(){that._cleanup(true)});try{that.xdr.open(method,url);that.xdr.send(payload)}catch(x){onerror()}};XDRObject.prototype._cleanup=function(abort){var that=this;if(!that.xdr)return;utils.unload_del(that.unload_ref);that.xdr.ontimeout=that.xdr.onerror=that.xdr.onprogress=that.xdr.onload=null;if(abort){try{that.xdr.abort()}catch(x){}}that.unload_ref=that.xdr=null};XDRObject.prototype.close=function(){var that=this;that.nuke();that._cleanup(true)};utils.isXHRCorsCapable=function(){if(_window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest){return 1}if(_window.XDomainRequest&&_document.domain){return 2}if(IframeTransport.enabled()){return 3}return 4};var SockJS=function(url,dep_protocols_whitelist,options){if(this===window){return new SockJS(url,dep_protocols_whitelist,options)}var that=this,protocols_whitelist;that._options={devel:false,debug:false,protocols_whitelist:[],info:undefined,rtt:undefined};if(options){utils.objectExtend(that._options,options)}that._base_url=utils.amendUrl(url);that._server=that._options.server||utils.random_number_string(1e3);if(that._options.protocols_whitelist&&that._options.protocols_whitelist.length){protocols_whitelist=that._options.protocols_whitelist}else{if(typeof dep_protocols_whitelist==="string"&&dep_protocols_whitelist.length>0){protocols_whitelist=[dep_protocols_whitelist]}else if(utils.isArray(dep_protocols_whitelist)){protocols_whitelist=dep_protocols_whitelist}else{protocols_whitelist=null}if(protocols_whitelist){that._debug('Deprecated API: Use "protocols_whitelist" option '+"instead of supplying protocol list as a second "+"parameter to SockJS constructor.")}}that._protocols=[];that.protocol=null;that.readyState=SockJS.CONNECTING;that._ir=createInfoReceiver(that._base_url);that._ir.onfinish=function(info,rtt){that._ir=null;if(info){if(that._options.info){info=utils.objectExtend(info,that._options.info)}if(that._options.rtt){rtt=that._options.rtt}that._applyInfo(info,rtt,protocols_whitelist);that._didClose()}else{that._didClose(1002,"Can't connect to server",true)}}};SockJS.prototype=new REventTarget;SockJS.version="0.3.1.7.ga67f.dirty";SockJS.CONNECTING=0;SockJS.OPEN=1;SockJS.CLOSING=2;SockJS.CLOSED=3;SockJS.prototype._debug=function(){if(this._options.debug)utils.log.apply(utils,arguments)};SockJS.prototype._dispatchOpen=function(){var that=this;if(that.readyState===SockJS.CONNECTING){if(that._transport_tref){clearTimeout(that._transport_tref);that._transport_tref=null}that.readyState=SockJS.OPEN;that.dispatchEvent(new SimpleEvent("open"))}else{that._didClose(1006,"Server lost session")}};SockJS.prototype._dispatchMessage=function(data){var that=this;if(that.readyState!==SockJS.OPEN)return;that.dispatchEvent(new SimpleEvent("message",{data:data}))};SockJS.prototype._dispatchHeartbeat=function(data){var that=this;if(that.readyState!==SockJS.OPEN)return;that.dispatchEvent(new SimpleEvent("heartbeat",{}))};SockJS.prototype._didClose=function(code,reason,force){var that=this;if(that.readyState!==SockJS.CONNECTING&&that.readyState!==SockJS.OPEN&&that.readyState!==SockJS.CLOSING)throw new Error("INVALID_STATE_ERR");if(that._ir){that._ir.nuke();that._ir=null}if(that._transport){that._transport.doCleanup();that._transport=null}var close_event=new SimpleEvent("close",{code:code,reason:reason,wasClean:utils.userSetCode(code)});if(!utils.userSetCode(code)&&that.readyState===SockJS.CONNECTING&&!force){if(that._try_next_protocol(close_event)){return}close_event=new SimpleEvent("close",{code:2e3,reason:"All transports failed",wasClean:false,last_event:close_event})}that.readyState=SockJS.CLOSED;utils.delay(function(){that.dispatchEvent(close_event)})};SockJS.prototype._didMessage=function(data){var that=this;var type=data.slice(0,1);switch(type){case"o":that._dispatchOpen();break;case"a":var payload=JSON.parse(data.slice(1)||"[]");for(var i=0;i<payload.length;i++){that._dispatchMessage(payload[i])}break;case"m":var payload=JSON.parse(data.slice(1)||"null");that._dispatchMessage(payload);break;case"c":var payload=JSON.parse(data.slice(1)||"[]");that._didClose(payload[0],payload[1]);break;case"h":that._dispatchHeartbeat();break}};SockJS.prototype._try_next_protocol=function(close_event){var that=this;if(that.protocol){that._debug("Closed transport:",that.protocol,""+close_event);that.protocol=null}if(that._transport_tref){clearTimeout(that._transport_tref);that._transport_tref=null}while(1){var protocol=that.protocol=that._protocols.shift();if(!protocol){return false}if(SockJS[protocol]&&SockJS[protocol].need_body===true&&(!_document.body||typeof _document.readyState!=="undefined"&&_document.readyState!=="complete")){that._protocols.unshift(protocol);that.protocol="waiting-for-load";utils.attachEvent("load",function(){that._try_next_protocol()});return true}if(!SockJS[protocol]||!SockJS[protocol].enabled(that._options)){that._debug("Skipping transport:",protocol)}else{var roundTrips=SockJS[protocol].roundTrips||1;var to=(that._options.rto||0)*roundTrips||5e3;that._transport_tref=utils.delay(to,function(){if(that.readyState===SockJS.CONNECTING){that._didClose(2007,"Transport timeouted")}});var connid=utils.random_string(8);var trans_url=that._base_url+"/"+that._server+"/"+connid;that._debug("Opening transport:",protocol," url:"+trans_url," RTO:"+that._options.rto);that._transport=new SockJS[protocol](that,trans_url,that._base_url);return true}}};SockJS.prototype.close=function(code,reason){var that=this;if(code&&!utils.userSetCode(code))throw new Error("INVALID_ACCESS_ERR");if(that.readyState!==SockJS.CONNECTING&&that.readyState!==SockJS.OPEN){return false}that.readyState=SockJS.CLOSING;that._didClose(code||1e3,reason||"Normal closure");return true};SockJS.prototype.send=function(data){var that=this;if(that.readyState===SockJS.CONNECTING)throw new Error("INVALID_STATE_ERR");if(that.readyState===SockJS.OPEN){that._transport.doSend(utils.quote(""+data))}return true};SockJS.prototype._applyInfo=function(info,rtt,protocols_whitelist){var that=this;that._options.info=info;that._options.rtt=rtt;that._options.rto=utils.countRTO(rtt);that._options.info.null_origin=!_document.domain;var probed=utils.probeProtocols();that._protocols=utils.detectProtocols(probed,protocols_whitelist,info)};var WebSocketTransport=SockJS.websocket=function(ri,trans_url){var that=this;var url=trans_url+"/websocket";if(url.slice(0,5)==="https"){url="wss"+url.slice(5)}else{url="ws"+url.slice(4)}that.ri=ri;that.url=url;var Constructor=_window.WebSocket||_window.MozWebSocket;that.ws=new Constructor(that.url);that.ws.onmessage=function(e){that.ri._didMessage(e.data)};that.unload_ref=utils.unload_add(function(){that.ws.close()});that.ws.onclose=function(){that.ri._didMessage(utils.closeFrame(1006,"WebSocket connection broken"))}};WebSocketTransport.prototype.doSend=function(data){this.ws.send("["+data+"]")};WebSocketTransport.prototype.doCleanup=function(){var that=this;var ws=that.ws;if(ws){ws.onmessage=ws.onclose=null;ws.close();utils.unload_del(that.unload_ref);that.unload_ref=that.ri=that.ws=null}};WebSocketTransport.enabled=function(){return!!(_window.WebSocket||_window.MozWebSocket)};WebSocketTransport.roundTrips=2;var BufferedSender=function(){};BufferedSender.prototype.send_constructor=function(sender){var that=this;that.send_buffer=[];that.sender=sender};BufferedSender.prototype.doSend=function(message){var that=this;that.send_buffer.push(message);if(!that.send_stop){that.send_schedule()}};BufferedSender.prototype.send_schedule_wait=function(){var that=this;var tref;that.send_stop=function(){that.send_stop=null;clearTimeout(tref)};tref=utils.delay(25,function(){that.send_stop=null;that.send_schedule()})};BufferedSender.prototype.send_schedule=function(){var that=this;if(that.send_buffer.length>0){var payload="["+that.send_buffer.join(",")+"]";that.send_stop=that.sender(that.trans_url,payload,function(){that.send_stop=null;that.send_schedule_wait()});that.send_buffer=[]}};BufferedSender.prototype.send_destructor=function(){var that=this;if(that._send_stop){that._send_stop()}that._send_stop=null};var jsonPGenericSender=function(url,payload,callback){var that=this;if(!("_send_form"in that)){var form=that._send_form=_document.createElement("form");var area=that._send_area=_document.createElement("textarea");area.name="d";form.style.display="none";form.style.position="absolute";form.method="POST";form.enctype="application/x-www-form-urlencoded";form.acceptCharset="UTF-8";form.appendChild(area);_document.body.appendChild(form)}var form=that._send_form;var area=that._send_area;var id="a"+utils.random_string(8);form.target=id;form.action=url+"/jsonp_send?i="+id;var iframe;try{iframe=_document.createElement('<iframe name="'+id+'">')}catch(x){iframe=_document.createElement("iframe");iframe.name=id}iframe.id=id;form.appendChild(iframe);iframe.style.display="none";try{area.value=payload}catch(e){utils.log("Your browser is seriously broken. Go home! "+e.message)}form.submit();var completed=function(e){if(!iframe.onerror)return;iframe.onreadystatechange=iframe.onerror=iframe.onload=null;utils.delay(500,function(){iframe.parentNode.removeChild(iframe);iframe=null});area.value="";callback()};iframe.onerror=iframe.onload=completed;iframe.onreadystatechange=function(e){if(iframe.readyState=="complete")completed()};return completed};var createAjaxSender=function(AjaxObject){return function(url,payload,callback){var xo=new AjaxObject("POST",url+"/xhr_send",payload);xo.onfinish=function(status,text){callback(status)};return function(abort_reason){callback(0,abort_reason)}}};var jsonPGenericReceiver=function(url,callback){var tref;var script=_document.createElement("script");var script2;var close_script=function(frame){if(script2){script2.parentNode.removeChild(script2);script2=null}if(script){clearTimeout(tref);script.parentNode.removeChild(script);script.onreadystatechange=script.onerror=script.onload=script.onclick=null;script=null;callback(frame);callback=null}};var loaded_okay=false;var error_timer=null;script.id="a"+utils.random_string(8);script.src=url;script.type="text/javascript";script.charset="UTF-8";script.onerror=function(e){if(!error_timer){error_timer=setTimeout(function(){if(!loaded_okay){close_script(utils.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))}},1e3)}};script.onload=function(e){close_script(utils.closeFrame(1006,"JSONP script loaded abnormally (onload)"))};script.onreadystatechange=function(e){if(/loaded|closed/.test(script.readyState)){if(script&&script.htmlFor&&script.onclick){loaded_okay=true;try{script.onclick()}catch(x){}}if(script){close_script(utils.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}}};if(typeof script.async==="undefined"&&_document.attachEvent){if(!/opera/i.test(navigator.userAgent)){try{script.htmlFor=script.id;script.event="onclick"}catch(x){}script.async=true}else{script2=_document.createElement("script");script2.text="try{var a = document.getElementById('"+script.id+"'); if(a)a.onerror();}catch(x){};";script.async=script2.async=false}}if(typeof script.async!=="undefined"){script.async=true}tref=setTimeout(function(){close_script(utils.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var head=_document.getElementsByTagName("head")[0];head.insertBefore(script,head.firstChild);if(script2){head.insertBefore(script2,head.firstChild)}return close_script};var JsonPTransport=SockJS["jsonp-polling"]=function(ri,trans_url){utils.polluteGlobalNamespace();var that=this;that.ri=ri;that.trans_url=trans_url;that.send_constructor(jsonPGenericSender);that._schedule_recv()};JsonPTransport.prototype=new BufferedSender;JsonPTransport.prototype._schedule_recv=function(){var that=this;var callback=function(data){that._recv_stop=null;if(data){if(!that._is_closing){that.ri._didMessage(data)}}if(!that._is_closing){that._schedule_recv()}};that._recv_stop=jsonPReceiverWrapper(that.trans_url+"/jsonp",jsonPGenericReceiver,callback)};JsonPTransport.enabled=function(){return true};JsonPTransport.need_body=true;JsonPTransport.prototype.doCleanup=function(){var that=this;that._is_closing=true;if(that._recv_stop){that._recv_stop()}that.ri=that._recv_stop=null;that.send_destructor()};var jsonPReceiverWrapper=function(url,constructReceiver,user_callback){var id="a"+utils.random_string(6);var url_id=url+"?c="+escape(WPrefix+"."+id);var callback=function(frame){delete _window[WPrefix][id];user_callback(frame)};var close_script=constructReceiver(url_id,callback);_window[WPrefix][id]=close_script;var stop=function(){if(_window[WPrefix][id]){_window[WPrefix][id](utils.closeFrame(1e3,"JSONP user aborted read"))}};return stop};var AjaxBasedTransport=function(){};AjaxBasedTransport.prototype=new BufferedSender;AjaxBasedTransport.prototype.run=function(ri,trans_url,url_suffix,Receiver,AjaxObject){var that=this;that.ri=ri;that.trans_url=trans_url;that.send_constructor(createAjaxSender(AjaxObject));that.poll=new Polling(ri,Receiver,trans_url+url_suffix,AjaxObject)};AjaxBasedTransport.prototype.doCleanup=function(){var that=this;if(that.poll){that.poll.abort();that.poll=null}};var XhrStreamingTransport=SockJS["xhr-streaming"]=function(ri,trans_url){this.run(ri,trans_url,"/xhr_streaming",XhrReceiver,utils.XHRCorsObject)};XhrStreamingTransport.prototype=new AjaxBasedTransport;XhrStreamingTransport.enabled=function(){return _window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)};XhrStreamingTransport.roundTrips=2;XhrStreamingTransport.need_body=true;var XdrStreamingTransport=SockJS["xdr-streaming"]=function(ri,trans_url){this.run(ri,trans_url,"/xhr_streaming",XhrReceiver,utils.XDRObject)};XdrStreamingTransport.prototype=new AjaxBasedTransport;XdrStreamingTransport.enabled=function(){return!!_window.XDomainRequest};XdrStreamingTransport.roundTrips=2;var XhrPollingTransport=SockJS["xhr-polling"]=function(ri,trans_url){this.run(ri,trans_url,"/xhr",XhrReceiver,utils.XHRCorsObject)};XhrPollingTransport.prototype=new AjaxBasedTransport;XhrPollingTransport.enabled=XhrStreamingTransport.enabled;XhrPollingTransport.roundTrips=2;var XdrPollingTransport=SockJS["xdr-polling"]=function(ri,trans_url){this.run(ri,trans_url,"/xhr",XhrReceiver,utils.XDRObject)};XdrPollingTransport.prototype=new AjaxBasedTransport;XdrPollingTransport.enabled=XdrStreamingTransport.enabled;XdrPollingTransport.roundTrips=2;var IframeTransport=function(){};IframeTransport.prototype.i_constructor=function(ri,trans_url,base_url){var that=this;that.ri=ri;that.origin=utils.getOrigin(base_url);that.base_url=base_url;that.trans_url=trans_url;var iframe_url=base_url+"/iframe.html";if(that.ri._options.devel){iframe_url+="?t="+ +new Date}that.window_id=utils.random_string(8);iframe_url+="#"+that.window_id;that.iframeObj=utils.createIframe(iframe_url,function(r){that.ri._didClose(1006,"Unable to load an iframe ("+r+")")});that.onmessage_cb=utils.bind(that.onmessage,that);utils.attachMessage(that.onmessage_cb)};IframeTransport.prototype.doCleanup=function(){var that=this;if(that.iframeObj){utils.detachMessage(that.onmessage_cb);try{if(that.iframeObj.iframe.contentWindow){that.postMessage("c")}}catch(x){}that.iframeObj.cleanup();that.iframeObj=null;that.onmessage_cb=that.iframeObj=null}};IframeTransport.prototype.onmessage=function(e){var that=this;if(e.origin!==that.origin)return;var window_id=e.data.slice(0,8);var type=e.data.slice(8,9);var data=e.data.slice(9);if(window_id!==that.window_id)return;switch(type){case"s":that.iframeObj.loaded();that.postMessage("s",JSON.stringify([SockJS.version,that.protocol,that.trans_url,that.base_url]));break;case"t":that.ri._didMessage(data);break}};IframeTransport.prototype.postMessage=function(type,data){var that=this;that.iframeObj.post(that.window_id+type+(data||""),that.origin)};IframeTransport.prototype.doSend=function(message){this.postMessage("m",message)};IframeTransport.enabled=function(){var konqueror=navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Konqueror")!==-1;return(typeof _window.postMessage==="function"||typeof _window.postMessage==="object")&&!konqueror};var curr_window_id;var postMessage=function(type,data){if(parent!==_window){parent.postMessage(curr_window_id+type+(data||""),"*")}else{utils.log("Can't postMessage, no parent window.",type,data)}};var FacadeJS=function(){};FacadeJS.prototype._didClose=function(code,reason){postMessage("t",utils.closeFrame(code,reason))};FacadeJS.prototype._didMessage=function(frame){postMessage("t",frame)};FacadeJS.prototype._doSend=function(data){this._transport.doSend(data)};FacadeJS.prototype._doCleanup=function(){this._transport.doCleanup()};utils.parent_origin=undefined;SockJS.bootstrap_iframe=function(){var facade;curr_window_id=_document.location.hash.slice(1);var onMessage=function(e){if(e.source!==parent)return;if(typeof utils.parent_origin==="undefined")utils.parent_origin=e.origin;if(e.origin!==utils.parent_origin)return;var window_id=e.data.slice(0,8);var type=e.data.slice(8,9);var data=e.data.slice(9);if(window_id!==curr_window_id)return;switch(type){case"s":var p=JSON.parse(data);var version=p[0];var protocol=p[1];var trans_url=p[2];var base_url=p[3];if(version!==SockJS.version){utils.log("Incompatibile SockJS! Main site uses:"+' "'+version+'", the iframe:'+' "'+SockJS.version+'".')}if(!utils.flatUrl(trans_url)||!utils.flatUrl(base_url)){utils.log("Only basic urls are supported in SockJS");return}if(!utils.isSameOriginUrl(trans_url)||!utils.isSameOriginUrl(base_url)){utils.log("Can't connect to different domain from within an "+"iframe. ("+JSON.stringify([_window.location.href,trans_url,base_url])+")");return}facade=new FacadeJS;facade._transport=new FacadeJS[protocol](facade,trans_url,base_url);break;case"m":facade._doSend(data);break;case"c":if(facade)facade._doCleanup();facade=null;break}};utils.attachMessage(onMessage);postMessage("s")};var InfoReceiver=function(base_url,AjaxObject){var that=this;utils.delay(function(){that.doXhr(base_url,AjaxObject)})};InfoReceiver.prototype=new EventEmitter(["finish"]);InfoReceiver.prototype.doXhr=function(base_url,AjaxObject){var that=this;var t0=(new Date).getTime();var xo=new AjaxObject("GET",base_url+"/info");var tref=utils.delay(8e3,function(){xo.ontimeout()});xo.onfinish=function(status,text){clearTimeout(tref);tref=null;if(status===200){var rtt=(new Date).getTime()-t0;var info=JSON.parse(text);if(typeof info!=="object")info={};that.emit("finish",info,rtt)}else{that.emit("finish")}};xo.ontimeout=function(){xo.close();that.emit("finish")}};var InfoReceiverIframe=function(base_url){var that=this;var go=function(){var ifr=new IframeTransport;ifr.protocol="w-iframe-info-receiver";var fun=function(r){if(typeof r==="string"&&r.substr(0,1)==="m"){var d=JSON.parse(r.substr(1));var info=d[0],rtt=d[1];that.emit("finish",info,rtt)}else{that.emit("finish")}ifr.doCleanup();ifr=null};var mock_ri={_options:{},_didClose:fun,_didMessage:fun};ifr.i_constructor(mock_ri,base_url,base_url)};if(!_document.body){utils.attachEvent("load",go)}else{go()}};InfoReceiverIframe.prototype=new EventEmitter(["finish"]);var InfoReceiverFake=function(){var that=this;utils.delay(function(){that.emit("finish",{},2e3)})};InfoReceiverFake.prototype=new EventEmitter(["finish"]);var createInfoReceiver=function(base_url){if(utils.isSameOriginUrl(base_url)){return new InfoReceiver(base_url,utils.XHRLocalObject)}switch(utils.isXHRCorsCapable()){case 1:return new InfoReceiver(base_url,utils.XHRCorsObject);case 2:return new InfoReceiver(base_url,utils.XDRObject);case 3:return new InfoReceiverIframe(base_url);default:return new InfoReceiverFake}};var WInfoReceiverIframe=FacadeJS["w-iframe-info-receiver"]=function(ri,_trans_url,base_url){var ir=new InfoReceiver(base_url,utils.XHRLocalObject);ir.onfinish=function(info,rtt){ri._didMessage("m"+JSON.stringify([info,rtt]));ri._didClose()}};WInfoReceiverIframe.prototype.doCleanup=function(){};var EventSourceIframeTransport=SockJS["iframe-eventsource"]=function(){var that=this;that.protocol="w-iframe-eventsource";that.i_constructor.apply(that,arguments)};EventSourceIframeTransport.prototype=new IframeTransport;EventSourceIframeTransport.enabled=function(){return"EventSource"in _window&&IframeTransport.enabled()};EventSourceIframeTransport.need_body=true;EventSourceIframeTransport.roundTrips=3;var EventSourceTransport=FacadeJS["w-iframe-eventsource"]=function(ri,trans_url){this.run(ri,trans_url,"/eventsource",EventSourceReceiver,utils.XHRLocalObject)};EventSourceTransport.prototype=new AjaxBasedTransport;var XhrPollingIframeTransport=SockJS["iframe-xhr-polling"]=function(){var that=this;that.protocol="w-iframe-xhr-polling";that.i_constructor.apply(that,arguments)};XhrPollingIframeTransport.prototype=new IframeTransport;XhrPollingIframeTransport.enabled=function(){return _window.XMLHttpRequest&&IframeTransport.enabled()};XhrPollingIframeTransport.need_body=true;XhrPollingIframeTransport.roundTrips=3;var XhrPollingITransport=FacadeJS["w-iframe-xhr-polling"]=function(ri,trans_url){this.run(ri,trans_url,"/xhr",XhrReceiver,utils.XHRLocalObject)};XhrPollingITransport.prototype=new AjaxBasedTransport;var HtmlFileIframeTransport=SockJS["iframe-htmlfile"]=function(){var that=this;that.protocol="w-iframe-htmlfile";that.i_constructor.apply(that,arguments)};HtmlFileIframeTransport.prototype=new IframeTransport;HtmlFileIframeTransport.enabled=function(){return IframeTransport.enabled()};HtmlFileIframeTransport.need_body=true;HtmlFileIframeTransport.roundTrips=3;var HtmlFileTransport=FacadeJS["w-iframe-htmlfile"]=function(ri,trans_url){this.run(ri,trans_url,"/htmlfile",HtmlfileReceiver,utils.XHRLocalObject)};HtmlFileTransport.prototype=new AjaxBasedTransport;var Polling=function(ri,Receiver,recv_url,AjaxObject){var that=this;that.ri=ri;that.Receiver=Receiver;that.recv_url=recv_url;that.AjaxObject=AjaxObject;that._scheduleRecv()};Polling.prototype._scheduleRecv=function(){var that=this;var poll=that.poll=new that.Receiver(that.recv_url,that.AjaxObject);var msg_counter=0;poll.onmessage=function(e){msg_counter+=1;that.ri._didMessage(e.data)};poll.onclose=function(e){that.poll=poll=poll.onmessage=poll.onclose=null;if(!that.poll_is_closing){if(e.reason==="permanent"){that.ri._didClose(1006,"Polling error ("+e.reason+")")}else{that._scheduleRecv()}}}};Polling.prototype.abort=function(){var that=this;that.poll_is_closing=true;if(that.poll){that.poll.abort()}};var EventSourceReceiver=function(url){var that=this;var es=new EventSource(url);es.onmessage=function(e){that.dispatchEvent(new SimpleEvent("message",{data:unescape(e.data)}))};that.es_close=es.onerror=function(e,abort_reason){var reason=abort_reason?"user":es.readyState!==2?"network":"permanent";that.es_close=es.onmessage=es.onerror=null;es.close();es=null;utils.delay(200,function(){that.dispatchEvent(new SimpleEvent("close",{reason:reason}))})}};EventSourceReceiver.prototype=new REventTarget;EventSourceReceiver.prototype.abort=function(){var that=this;if(that.es_close){that.es_close({},true)}};var _is_ie_htmlfile_capable;var isIeHtmlfileCapable=function(){if(_is_ie_htmlfile_capable===undefined){if("ActiveXObject"in _window){try{_is_ie_htmlfile_capable=!!new ActiveXObject("htmlfile")}catch(x){}}else{_is_ie_htmlfile_capable=false}}return _is_ie_htmlfile_capable};var HtmlfileReceiver=function(url){var that=this;utils.polluteGlobalNamespace();that.id="a"+utils.random_string(6,26);url+=(url.indexOf("?")===-1?"?":"&")+"c="+escape(WPrefix+"."+that.id);var constructor=isIeHtmlfileCapable()?utils.createHtmlfile:utils.createIframe;var iframeObj;_window[WPrefix][that.id]={start:function(){iframeObj.loaded()},message:function(data){that.dispatchEvent(new SimpleEvent("message",{data:data}))},stop:function(){that.iframe_close({},"network")}};that.iframe_close=function(e,abort_reason){iframeObj.cleanup();that.iframe_close=iframeObj=null;delete _window[WPrefix][that.id];that.dispatchEvent(new SimpleEvent("close",{reason:abort_reason}))};iframeObj=constructor(url,function(e){that.iframe_close({},"permanent")})};HtmlfileReceiver.prototype=new REventTarget;HtmlfileReceiver.prototype.abort=function(){var that=this;if(that.iframe_close){that.iframe_close({},"user")}};var XhrReceiver=function(url,AjaxObject){var that=this;var buf_pos=0;that.xo=new AjaxObject("POST",url,null);that.xo.onchunk=function(status,text){if(status!==200)return;while(1){var buf=text.slice(buf_pos);var p=buf.indexOf("\n");if(p===-1)break;buf_pos+=p+1;var msg=buf.slice(0,p);that.dispatchEvent(new SimpleEvent("message",{data:msg}))}};that.xo.onfinish=function(status,text){that.xo.onchunk(status,text);that.xo=null;var reason=status===200?"network":"permanent";that.dispatchEvent(new SimpleEvent("close",{reason:reason}))}};XhrReceiver.prototype=new REventTarget;XhrReceiver.prototype.abort=function(){var that=this;if(that.xo){that.xo.close();that.dispatchEvent(new SimpleEvent("close",{reason:"user"}));that.xo=null}};SockJS.getUtils=function(){return utils};SockJS.getIframeTransport=function(){return IframeTransport};return SockJS}();if("_sockjs_onload"in window)setTimeout(_sockjs_onload,1);
if(typeof define==="function"&&define.amd){define("sockjs",[],function(){return SockJS})}if(typeof module==="object"&&module&&module.exports){module.exports=SockJS}});require.define("/node_modules/reconnect/inject.js",function(require,module,exports,__dirname,__filename,process,global){var EventEmitter=require("events").EventEmitter;var backoff=require("backoff");module.exports=function(createConnection){return function(opts,onConnect){onConnect="function"==typeof opts?opts:onConnect;opts=opts||{initialDelay:1e3,maxDelay:3e4};if(!onConnect)onConnect=opts.onConnect;var emitter=new EventEmitter;emitter.connected=false;emitter.reconnect=true;if(onConnect)emitter.on("connect",onConnect);var backoffMethod=(backoff[opts.type]||backoff.fibonacci)(opts);backoffMethod.on("backoff",function(n,d){emitter.emit("backoff",n,d)});var args;function attempt(n,delay){if(emitter.connected)return;if(!emitter.reconnect)return;emitter.emit("reconnect",n,delay);var con=createConnection.apply(null,args);emitter._connection=con;function onDisconnect(){emitter.connected=false;con.removeListener("error",onDisconnect);con.removeListener("close",onDisconnect);con.removeListener("end",onDisconnect);if(con.constructor.name=="Request")con.on("error",function(){});emitter.emit("disconnect",con);if(!emitter.reconnect)return;backoffMethod.backoff()}con.on("error",onDisconnect).on("close",onDisconnect).on("end",onDisconnect);if(con.constructor.name=="Request"){emitter.connected=true;emitter.emit("connect",con);con.once("data",function(){backoffMethod.reset()})}else{con.on("connect",function(){backoffMethod.reset();emitter.connected=true;con.removeListener("connect",onConnect);emitter.emit("connect",con)})}}emitter.connect=emitter.listen=function(){this.reconnect=true;if(emitter.connected)return;backoffMethod.reset();backoffMethod.on("ready",attempt);args=[].slice.call(arguments);attempt(0,0);return emitter};emitter.reconnect=function(){if(this.connected)return emitter.disconnect();backoffMethod.reset();attempt(0,0);return emitter};emitter.disconnect=function(){this.reconnect=false;if(!emitter.connected)return emitter;else if(emitter._connection)emitter._connection.destroy();emitter.emit("disconnect");return emitter};var widget;emitter.widget=function(){if(!widget)widget=require("./widget")(emitter);return widget};return emitter}}});require.define("/node_modules/reconnect/node_modules/backoff/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={}});require.define("/node_modules/reconnect/node_modules/backoff/index.js",function(require,module,exports,__dirname,__filename,process,global){var Backoff=require("./lib/backoff"),FibonacciBackoffStrategy=require("./lib/strategy/fibonacci"),ExponentialBackoffStrategy=require("./lib/strategy/exponential");module.exports.Backoff=Backoff;module.exports.FibonacciStrategy=FibonacciBackoffStrategy;module.exports.ExponentialStrategy=ExponentialBackoffStrategy;module.exports.fibonacci=function(options){return new Backoff(new FibonacciBackoffStrategy(options))};module.exports.exponential=function(options){return new Backoff(new ExponentialBackoffStrategy(options))}});require.define("/node_modules/reconnect/node_modules/backoff/lib/backoff.js",function(require,module,exports,__dirname,__filename,process,global){var events=require("events"),util=require("util");function Backoff(backoffStrategy){events.EventEmitter.call(this);this.backoffStrategy_=backoffStrategy;this.backoffNumber_=0;this.backoffDelay_=0;this.timeoutID_=-1;this.handlers={backoff:this.onBackoff_.bind(this)}}util.inherits(Backoff,events.EventEmitter);Backoff.prototype.backoff=function(){if(this.timeoutID_!==-1){throw new Error("Backoff in progress.")}this.backoffDelay_=this.backoffStrategy_.next();this.timeoutID_=setTimeout(this.handlers.backoff,this.backoffDelay_);this.emit("backoff",this.backoffNumber_,this.backoffDelay_)};Backoff.prototype.onBackoff_=function(){this.timeoutID_=-1;this.emit("ready",this.backoffNumber_++,this.backoffDelay_)};Backoff.prototype.reset=function(){this.backoffNumber_=0;this.backoffStrategy_.reset();clearTimeout(this.timeoutID_);this.timeoutID_=-1};module.exports=Backoff});require.define("/node_modules/reconnect/node_modules/backoff/lib/strategy/fibonacci.js",function(require,module,exports,__dirname,__filename,process,global){var util=require("util");var BackoffStrategy=require("./strategy");function FibonacciBackoffStrategy(options){BackoffStrategy.call(this,options);this.backoffDelay_=0;this.nextBackoffDelay_=this.getInitialDelay()}util.inherits(FibonacciBackoffStrategy,BackoffStrategy);FibonacciBackoffStrategy.prototype.next_=function(){var backoffDelay=Math.min(this.nextBackoffDelay_,this.getMaxDelay());this.nextBackoffDelay_+=this.backoffDelay_;this.backoffDelay_=backoffDelay;return backoffDelay};FibonacciBackoffStrategy.prototype.reset_=function(){this.nextBackoffDelay_=this.getInitialDelay();this.backoffDelay_=0};module.exports=FibonacciBackoffStrategy});require.define("/node_modules/reconnect/node_modules/backoff/lib/strategy/strategy.js",function(require,module,exports,__dirname,__filename,process,global){var events=require("events"),util=require("util");function isDef(value){return value!==undefined&&value!==null}function BackoffStrategy(options){options=options||{};if(isDef(options.initialDelay)&&options.initialDelay<1){throw new Error("The initial timeout must be greater than 0.")}else if(isDef(options.maxDelay)&&options.maxDelay<1){throw new Error("The maximal timeout must be greater than 0.")}this.initialDelay_=options.initialDelay||100;this.maxDelay_=options.maxDelay||1e4;if(this.maxDelay_<=this.initialDelay_){throw new Error("The maximal backoff delay must be "+"greater than the initial backoff delay.")}if(isDef(options.randomisationFactor)&&(options.randomisationFactor<0||options.randomisationFactor>1)){throw new Error("The randomisation factor must be between 0 and 1.")}this.randomisationFactor_=options.randomisationFactor||0}BackoffStrategy.prototype.getMaxDelay=function(){return this.maxDelay_};BackoffStrategy.prototype.getInitialDelay=function(){return this.initialDelay_};BackoffStrategy.prototype.next=function(){var backoffDelay=this.next_();var randomisationMultiple=1+Math.random()*this.randomisationFactor_;var randomizedDelay=Math.round(backoffDelay*randomisationMultiple);return randomizedDelay};BackoffStrategy.prototype.next_=function(){throw new Error("BackoffStrategy.next_() unimplemented.")};BackoffStrategy.prototype.reset=function(){this.reset_()};BackoffStrategy.prototype.reset_=function(){throw new Error("BackoffStrategy.reset_() unimplemented.")};module.exports=BackoffStrategy});require.define("/node_modules/reconnect/node_modules/backoff/lib/strategy/exponential.js",function(require,module,exports,__dirname,__filename,process,global){var util=require("util");var BackoffStrategy=require("./strategy");function ExponentialBackoffStrategy(options){BackoffStrategy.call(this,options);this.backoffDelay_=0;this.nextBackoffDelay_=this.getInitialDelay()}util.inherits(ExponentialBackoffStrategy,BackoffStrategy);ExponentialBackoffStrategy.prototype.next_=function(){this.backoffDelay_=Math.min(this.nextBackoffDelay_,this.getMaxDelay());this.nextBackoffDelay_=this.backoffDelay_*2;return this.backoffDelay_};ExponentialBackoffStrategy.prototype.reset_=function(){this.backoffDelay_=0;this.nextBackoffDelay_=this.getInitialDelay()};module.exports=ExponentialBackoffStrategy});require.define("/node_modules/reconnect/widget.js",function(require,module,exports,__dirname,__filename,process,global){var h=require("h");module.exports=function(emitter){var style={};var el=h("a",{href:"#",style:style,click:function(){emitter.connected?emitter.disconnect():emitter.reconnect()}});var int;emitter.on("reconnect",function(n,d){var delay=Math.round(d/1e3)+1;console.log(n,d);el.innerText="reconnect in "+delay;clearInterval(int);int=setInterval(function(){el.innerText=delay?"reconnect in "+--delay:"reconnecting..."},1e3)});emitter.on("connect",function(){el.innerText="connected";clearInterval(int)});return el}});require.define("/node_modules/reconnect/node_modules/h/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={}});require.define("/node_modules/reconnect/node_modules/h/index.js",function(require,module,exports,__dirname,__filename,process,global){(function(){function h(){var args=[].slice.call(arguments),e=null;function item(l){function parseClass(string){var m=string.split(/([\.#]?[a-zA-Z0-9_-]+)/);m.forEach(function(v){var s=v.substring(1,v.length);if(!v)return;if(!e)e=document.createElement(v);else if(v[0]===".")e.classList.add(s);else if(v[0]==="#")e.setAttribute("id",s)})}if(l==null);else if("string"===typeof l){if(!e)parseClass(l);else e.appendChild(document.createTextNode(l))}else if("number"===typeof l||"boolean"===typeof l||l instanceof Date||l instanceof RegExp){e.appendChild(document.createTextNode(l.toString()))}else if(Array.isArray(l))l.forEach(item);else if(l instanceof HTMLElement)e.appendChild(l);else if("object"===typeof l){for(var k in l){if("function"===typeof l[k])e.addEventListener(k,l[k]);else if(k==="style"){for(var s in l[k])e.style.setProperty(s,l[k][s])}else e.setAttribute(k,l[k])}}}while(args.length){item(args.shift())}return e}if(typeof module==="object")module.exports=h;else this.h=h})()});require.define("/node_modules/client-reloader/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={browserify:"./browser.js"}});require.define("/node_modules/client-reloader/browser.js",function(require,module,exports,__dirname,__filename,process,global){var header=require("header-stream");var version=0;module.exports=function(handler,init){return function(stream){var args=[].slice.call(arguments);init=init||{};init.version=version||0;header(stream).setHeader(init).writeHead();stream.on("header",function(meta){if(!version)version=meta.version;if(meta.version!==version&&version!==0){stream.emit("reload",meta.version,version);stream.end();return window.location.reload(true)}else version=meta.version;handler.apply(this,args)})}}});require.define("/node_modules/client-reloader/node_modules/header-stream/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={}});require.define("/node_modules/client-reloader/node_modules/header-stream/index.js",function(require,module,exports,__dirname,__filename,process,global){function merge(a,b){for(var k in b)a[k]=a[k]||b[k]}module.exports=function header(stream){var emit=stream.emit;var write=stream.write;var soFar="";stream.emit=function(event,data){if(event!=="data")return emit.apply(stream,arguments);soFar+=data;var m;if(!(m=/\n/.exec(soFar)))return;var meta=JSON.parse(soFar.substring(0,m.index));soFar=soFar.substring(m.index+1);stream.emit=emit;stream.meta=meta;stream.emit("header",meta);if(""!==soFar&&stream.readable)stream.emit("data",soFar)};var meta={};stream.setHeader=function(key,val){if("string"===typeof key)meta[key]=val;else merge(meta,key);return stream};stream.writeHead=function(_meta){if(_meta)merge(meta,_meta);stream.write=write;stream.write(JSON.stringify(meta)+"\n")};stream.write=function(data){stream.writeHead();return stream.write(data)};return stream}});require.define("/node_modules/level-scuttlebutt/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={}});require.define("/node_modules/level-scuttlebutt/client.js",function(require,module,exports,__dirname,__filename,process,global){var Schema=require("./lib/schema");var Client=require("./lib/client-opener");var Buffered=require("./lib/buffered-opener");module.exports=function(schema){schema=Schema(schema);var c=Client();var b=Buffered(schema);c.on("open",function(){b.swap(c)});b.createStream=b.createRemoteStream=c.createStream;return b}});require.define("/node_modules/level-scuttlebutt/lib/schema.js",function(require,module,exports,__dirname,__filename,process,global){var parserx=require("parse-regexp");var exports=module.exports=function(schema){if("function"==typeof schema)return schema;var rules=[];for(var p in schema){rules.push({rx:parserx(p)||p,fn:schema[p]})}function match(key){if("object"===typeof key)return key;for(var i in rules){var r=rules[i];var m=key.match(r.rx);if(m&&m.index===0){var scuttlebutt=r.fn(key);scuttlebutt.name=key;return scuttlebutt}}}match.schema=schema;match.rules=rules;return match};exports.schema=exports;exports.cache=function(schema,open,onCache){var local=cached.local={};function cached(name,tail,cb){if("function"==typeof tail)cb=tail,tail=true;if("string"!==typeof name)throw new Error("name must be string");var cached=local[name];if(cached&&"function"===typeof cached.clone){var n=cached.clone();n.name=name;cb(null,n);return n}var clone;var scuttlebutt=local[name]=schema(name);scuttlebutt.name=name;open(scuttlebutt,tail,function(err,scuttlebutt){if(err)return cb(err);cb(null,clone)});if(!scuttlebutt)return;scuttlebutt.name=name;if("function"===typeof scuttlebutt.clone){local[name]=scuttlebutt;clone=scuttlebutt.clone();clone.name=name;if(onCache)onCache("clone",scuttlebutt.name);var timer=null;scuttlebutt.on("unstream",function(n){if(n===1){clearTimeout(timer);timer=setTimeout(function(){scuttlebutt.dispose();if(onCache)onCache("uncache",scuttlebutt.name)},TIMEOUT*1.5)}else if(n>1)clearTimeout(timer)});scuttlebutt.on("dispose",function(){delete local[name]})}return scuttlebutt}return cached};exports.sync=exports.open=function(schema,connect){return function(name,tail,cb){if("function"==typeof tail)cb=tail,tail=true;if("string"===typeof name)throw new Error("expect cache to create Scuttlebutt for open");var scuttlebutt=name;var es=scuttlebutt.createStream();var stream=connect(scuttlebutt.name);if(!stream)return cb(new Error("unable to connect"));stream.pipe(es).pipe(stream);var ready=false;es.once("sync",function(){if(ready)return;ready=true;if(cb)cb(null,scuttlebutt);if(!tail)es.end()});stream.once("error",function(err){if(!ready)return cb(err)});return scuttlebutt}}});require.define("/node_modules/parse-regexp/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={}});require.define("/node_modules/parse-regexp/index.js",function(require,module,exports,__dirname,__filename,process,global){var rx=/^\/((?:\\\/|[^\/])+)\/(.*)$/;module.exports=function(string){var m=rx.exec(string);return m?new RegExp(m[1],m[2]):null}});require.define("/node_modules/level-scuttlebutt/lib/client-opener.js",function(require,module,exports,__dirname,__filename,process,global){var EventEmitter=require("events").EventEmitter;var MuxDemux=require("mux-demux");var remoteOpen=function(connect){return function(scuttlebutt,tail,cb){if("function"==typeof tail)cb=tail,tail=true;if("object"!==typeof scuttlebutt)throw new Error("expect Scuttlebutt, not "+typeof scuttlebutt);var es=scuttlebutt.createStream(),stream;try{stream=connect(scuttlebutt.name)}catch(err){return cb(err)}if(!stream)return cb(new Error("unable to connect"));stream.pipe(es).pipe(stream);var ready=false;es.once("sync",function(){if(ready)return;ready=true;if(cb)cb(null,scuttlebutt);if(!tail)es.end()});stream.once("error",function(err){if(!ready)return cb(err)});return scuttlebutt}};module.exports=function(){var opener=new EventEmitter;var mx=null;opener.open=remoteOpen(function(name){if(!mx)throw new Error("scuttlebutt remoteOpener must be connected");return mx.createStream(name)});opener.view=function(){var args=[].slice.call(arguments)};opener.createStream=function(){if(mx)throw new Error("remoteOpener may only connect to one server");mx=MuxDemux(function(stream){stream.error(new Error("remoteOpener is client only - cannot recieve stream"))});mx.on("close",function(){mx.removeAllListeners();mx=null;opener.emit("close")});process.nextTick(function(){opener.emit("open",mx);mx.resume()});return mx};return opener}});require.define("/node_modules/level-scuttlebutt/node_modules/mux-demux/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={}});require.define("/node_modules/level-scuttlebutt/node_modules/mux-demux/index.js",function(require,module,exports,__dirname,__filename,process,global){"use strict";var through=require("through"),extend=require("xtend"),duplex=require("duplex"),serializer=require("stream-serializer");function MuxDemux(opts,onConnection){if("function"===typeof opts)onConnection=opts,opts=null;opts=opts||{};function createID(){return Math.random().toString(16).slice(2)+Math.random().toString(16).slice(2)}var streams={},streamCount=0;var md=duplex().resume();md.on("_data",function(data){var id=data.shift();var event=data[0];var s=streams[id];if(!s){if(event=="close")return;if(event!="new")return outer.emit("unknown",id);md.emit("connection",createStream(id,data[1].meta,data[1].opts))}else if(event==="pause")s.paused=true;else if(event==="resume"){var p=s.paused;s.paused=false;if(p)s.emit("drain")}else if(event==="error"){var error=data[1];if(typeof error==="string"){s.emit("error",new Error(error))}else if(typeof error.message==="string"){var e=new Error(error.message);extend(e,error);s.emit("error",e)}else{s.emit("error",error)}}else{s.emit.apply(s,data)}});function destroyAll(_err){md.removeListener("end",destroyAll);md.removeListener("error",destroyAll);md.removeListener("close",destroyAll);var err=_err||new Error("unexpected disconnection");for(var i in streams){var s=streams[i];s.destroyed=true;if(opts.error!==true){s.end()}else{s.emit("error",err);s.destroy()}}}function createStream(id,meta,opts){streamCount++;var s=through(function(data){if(!this.writable){var err=Error("stream is not writable: "+id);err.stream=this;return outer.emit("error",err)}md._data([s.id,"data",data])},function(){md._data([s.id,"end"]);if(this.readable&&!opts.allowHalfOpen&&!this.ended){this.emit("end")}});s.pause=function(){md._data([s.id,"pause"])};s.resume=function(){md._data([s.id,"resume"])};s.error=function(message){md._data([s.id,"error",message])};s.once("close",function(){delete streams[id];streamCount--;md._data([s.id,"close"]);if(streamCount===0)md.emit("zero")});s.writable=opts.writable;s.readable=opts.readable;streams[s.id=id]=s;s.meta=meta;return s}var outer=serializer(opts.wrapper)(md);if(md!==outer)md.on("connection",function(stream){outer.emit("connection",stream)});outer.close=function(cb){md.once("zero",function(){md._end();if(cb)cb()});return this};if(onConnection)outer.on("connection",onConnection);outer.on("connection",function(stream){if(outer.listeners("connection").length===1)stream.error("remote end lacks connection listener")});var pipe=outer.pipe;outer.pipe=function(dest,opts){pipe.call(outer,dest,opts);md.on("end",destroyAll);md.on("close",destroyAll);md.on("error",destroyAll);return dest};outer.createStream=function(meta,opts){opts=opts||{};if(!opts.writable&&!opts.readable)opts.readable=opts.writable=true;var s=createStream(createID(),meta,opts);var _opts={writable:opts.readable,readable:opts.writable};md._data([s.id,"new",{meta:meta,opts:_opts}]);return s};outer.createWriteStream=function(meta){return outer.createStream(meta,{writable:true,readable:false})};outer.createReadStream=function(meta){return outer.createStream(meta,{writable:false,readable:true})};return outer}module.exports=MuxDemux});require.define("/node_modules/level-scuttlebutt/node_modules/mux-demux/node_modules/through/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={main:"index.js"}});require.define("/node_modules/level-scuttlebutt/node_modules/mux-demux/node_modules/through/index.js",function(require,module,exports,__dirname,__filename,process,global){var Stream=require("stream");exports=module.exports=through;through.through=through;function through(write,end){write=write||function(data){this.emit("data",data)};end=end||function(){this.emit("end")};var ended=false,destroyed=false;var stream=new Stream,buffer=[];stream.buffer=buffer;stream.readable=stream.writable=true;stream.paused=false;stream.write=function(data){write.call(this,data);return!stream.paused};function drain(){while(buffer.length&&!stream.paused){var data=buffer.shift();if(null===data)return stream.emit("end");else stream.emit("data",data)}}stream.queue=function(data){buffer.push(data);drain()};stream.on("end",function(){stream.readable=false;if(!stream.writable)process.nextTick(function(){stream.destroy()})});function _end(){stream.writable=false;end.call(stream);if(!stream.readable)stream.destroy()}stream.end=function(data){if(ended)return;ended=true;if(arguments.length)stream.write(data);_end()};stream.destroy=function(){if(destroyed)return;destroyed=true;ended=true;buffer.length=0;stream.writable=stream.readable=false;stream.emit("close")};stream.pause=function(){if(stream.paused)return;stream.paused=true;stream.emit("pause")};stream.resume=function(){if(stream.paused){stream.paused=false}drain();if(!stream.paused)stream.emit("drain")};return stream}});require.define("/node_modules/xtend/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={main:"index"}});require.define("/node_modules/xtend/index.js",function(require,module,exports,__dirname,__filename,process,global){module.exports=extend;function extend(target){for(var i=1;i<arguments.length;i++){var source=arguments[i],keys=Object.keys(source);for(var j=0;j<keys.length;j++){var name=keys[j];target[name]=source[name]}}return target}});require.define("/node_modules/duplex/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={}});require.define("/node_modules/duplex/index.js",function(require,module,exports,__dirname,__filename,process,global){var Stream=require("stream");module.exports=function(write,end){var stream=new Stream;var buffer=[],ended=false,destroyed=false,emitEnd;stream.writable=stream.readable=true;stream.paused=false;stream._paused=false;stream.buffer=buffer;stream.on("pause",function(){stream._paused=true}).on("drain",function(){stream._paused=false});function destroySoon(){process.nextTick(stream.destroy.bind(stream))}if(write)stream.on("_data",write);if(end)stream.on("_end",end);stream.once("end",function(){stream.readable=false;if(!stream.writable){process.nextTick(function(){stream.destroy()})}});stream.once("_end",function(){stream.writable=false;if(!stream.readable)stream.destroy()});stream._data=function(data){if(!stream.paused&&!buffer.length)stream.emit("data",data);else buffer.push(data);return!(stream.paused||buffer.length)};stream._end=function(data){if(data)stream._data(data);if(emitEnd)return;emitEnd=true;stream.drain()};stream.write=function(data){stream.emit("_data",data);return!stream._paused};stream.end=function(){stream.writable=false;if(stream.ended)return;stream.ended=true;stream.emit("_end")};stream.drain=function(){if(!buffer.length&&!emitEnd)return;while(!stream.paused){if(buffer.length){stream.emit("data",buffer.shift());if(buffer.length==0){stream.emit("_drain")}}else if(emitEnd&&stream.readable){stream.readable=false;stream.emit("end");return}else{return true}}};var started=false;stream.resume=function(){started=true;stream.paused=false;stream.drain();return stream};stream.destroy=function(){if(destroyed)return;destroyed=ended=true;buffer.length=0;stream.emit("close")};var pauseCalled=false;stream.pause=function(){started=true;stream.paused=true;stream.emit("_pause");return stream};stream._pause=function(){if(!stream._paused){stream._paused=true;stream.emit("pause")}return this};stream.paused=true;process.nextTick(function(){if(started)return;stream.resume()});return stream}});require.define("/node_modules/stream-serializer/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={}});require.define("/node_modules/stream-serializer/index.js",function(require,module,exports,__dirname,__filename,process,global){var EventEmitter=require("events").EventEmitter;exports=module.exports=function(wrapper){if("function"==typeof wrapper)return wrapper;return exports[wrapper]||exports.json};exports.json=function(stream){var write=stream.write;var soFar="";function parse(line){var js;try{js=JSON.parse(line)}catch(err){return console.error("invalid JSON",line)}if(js!==undefined)write.call(stream,js)}function onData(data){var lines=(soFar+data).split("\n");soFar=lines.pop();while(lines.length){parse(lines.shift())}}stream.write=onData;var end=stream.end;stream.end=function(data){if(data)stream.write(data);if(soFar){parse(soFar)}return end.call(stream)};stream.emit=function(event,data){if(event=="data"){data=JSON.stringify(data)+"\n"}EventEmitter.prototype.emit.call(stream,event,data)};return stream};exports.raw=function(stream){return stream}});require.define("/node_modules/level-scuttlebutt/lib/buffered-opener.js",function(require,module,exports,__dirname,__filename,process,global){var EventEmitter=require("events").EventEmitter;var Cache=require("./cache");var through=require("through");module.exports=function(schema){var opener=new EventEmitter;var _opener;opener.swap=function(newOpener){if(_opener)throw new Error('already has opener, expects opener.emit("close")');if(!newOpener)throw new Error("cannot swap null");_opener=newOpener;_opener.once("close",function(){_opener=null});ready();return opener};var toOpen=[],toView=[],_open,_view;opener.open=Cache(schema,function(scuttlebutt,tail,cb){if("object"!==typeof scuttlebutt)throw new Error("expected Scuttlebutt");if(!_opener)return toOpen.push([scuttlebutt,tail,cb]);_opener.open(scuttlebutt,tail,cb);return scuttlebutt});var cache=opener.open.local;opener.view=function(){var args=[].slice.call(arguments);if(_opener)return _opener.view.apply(null,args);var stream=through();toView.push({args:args,stream:stream});return stream};function ready(){while(_opener&&toOpen.length){var args=toOpen.shift();_opener.open.apply(null,args)}while(_opener&&toView.length){var v=toView.shift();_opener.view.apply(null,v.args).on("error",function(err){v.stream.emit("error",err)}).pipe(v.stream)}}return opener}});require.define("/node_modules/level-scuttlebutt/lib/cache.js",function(require,module,exports,__dirname,__filename,process,global){var Schema=require("./schema");var TIMEOUT=100;module.exports=function(schema,open,onCache){var local=cached.local={};schema=Schema(schema);function cached(name,tail,cb){if("function"==typeof tail)cb=tail,tail=true;if("string"!==typeof name)throw new Error("name must be string");var cached=local[name];if(cached&&"function"===typeof cached.clone){var n=cached.clone();n.name=name;cb(null,n);return n}var clone;var scuttlebutt=local[name]=schema(name);scuttlebutt.name=name;open(scuttlebutt,tail,function(err,scuttlebutt){if(err)return cb(err);cb(null,clone)});if(!scuttlebutt)return;scuttlebutt.name=name;if("function"===typeof scuttlebutt.clone){local[name]=scuttlebutt;clone=scuttlebutt.clone();clone.name=name;if(onCache)onCache("clone",scuttlebutt.name);var timer=null;scuttlebutt.on("unstream",function(n){if(n===1){clearTimeout(timer);timer=setTimeout(function(){scuttlebutt.dispose();if(onCache)onCache("uncache",scuttlebutt.name)},TIMEOUT*1.5)}else if(n>1)clearTimeout(timer)});scuttlebutt.on("dispose",function(){delete local[name]})}return scuttlebutt}return cached}});require.define("/node_modules/through/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={main:"index.js"}});require.define("/node_modules/through/index.js",function(require,module,exports,__dirname,__filename,process,global){var Stream=require("stream");exports=module.exports=through;through.through=through;function through(write,end){write=write||function(data){this.queue(data)};end=end||function(){this.queue(null)};var ended=false,destroyed=false,buffer=[];var stream=new Stream;stream.readable=stream.writable=true;stream.paused=false;stream.write=function(data){write.call(this,data);return!stream.paused};function drain(){while(buffer.length&&!stream.paused){var data=buffer.shift();if(null===data)return stream.emit("end");else stream.emit("data",data)}}stream.queue=function(data){buffer.push(data);drain();return stream};stream.on("end",function(){stream.readable=false;if(!stream.writable)process.nextTick(function(){stream.destroy()})});function _end(){stream.writable=false;end.call(stream);if(!stream.readable)stream.destroy()}stream.end=function(data){if(ended)return;ended=true;if(arguments.length)stream.write(data);_end();return stream};stream.destroy=function(){if(destroyed)return;destroyed=true;ended=true;buffer.length=0;stream.writable=stream.readable=false;stream.emit("close");return stream};stream.pause=function(){if(stream.paused)return;stream.paused=true;stream.emit("pause");return stream};stream.resume=function(){if(stream.paused){stream.paused=false}drain();if(!stream.paused)stream.emit("drain");return stream};return stream}});require.define("/node_modules/udid/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={browserify:"./browser.js"}});require.define("/node_modules/udid/browser.js",function(require,module,exports,__dirname,__filename,process,global){var tabs=require("count-tabs")();module.exports=function(name){if(!name)throw new Error("provide app name");return tabs.id}});require.define("/node_modules/udid/node_modules/count-tabs/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={}});require.define("/node_modules/udid/node_modules/count-tabs/index.js",function(require,module,exports,__dirname,__filename,process,global){var EventEmitter=require("events").EventEmitter;var hash=require("shasum");var id;var KEY="tabsQuery";var tabs={};var pattern=/^tabs:(.+)$/;var emitter,oldUp;module.exports=function(listener){var interval=500;function attach(){if(listener){emitter.on("change",listener);listener.call(emitter,emitter.up,0)}}if(emitter){attach();return emitter}emitter=new EventEmitter;emitter.tabs=tabs;var start=Date.now();for(var key in localStorage){var m;if(m=pattern.exec(key)){var _id=m[1];if(!id&&Number(localStorage[key])<start-interval*2){emitter.id=id=_id;localStorage["tabs:"+id]=start}tabs[_id]=Number(localStorage[key])}}if(!id){emitter.id=id=hash(Date.now());tabs[id]=localStorage["tabs:"+id]=start}function count(){var now=Date.now();for(var _id in tabs){if(Number(tabs[_id])<now-interval*2){delete tabs[_id];emitter.emit("close",_id);change=true}}var up=Object.keys(tabs).sort();if(!oldUp||up.join("|")!=oldUp.join("|")){var l=oldUp?oldUp.length:0;emitter.up=up.length;oldUp=up;emitter.emit("change",tabs,l)}}count();window.addEventListener("storage",function(se){if(m=pattern.exec(se.key)){var _id=m[1];if(se.newValue)tabs[_id]=Number(se.newValue);else delete tabs[_id];count()}});setInterval(function(){tabs[id]=localStorage["tabs:"+id]=Date.now();count()},interval);attach();return emitter}});require.define("/node_modules/shasum/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={}});require.define("/node_modules/shasum/index.js",function(require,module,exports,__dirname,__filename,process,global){var createHash=require("crypto").createHash;var Buffer=require("buffer").Buffer;module.exports=function hash(str,alg,format){str="string"===typeof str?str:Buffer.isBuffer(str)?str:JSON.stringify(str);return createHash(alg||"sha1").update(str).digest(format||"hex")}});require.define("crypto",function(require,module,exports,__dirname,__filename,process,global){module.exports=require("crypto-browserify")});require.define("/node_modules/crypto-browserify/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={}});require.define("/node_modules/crypto-browserify/index.js",function(require,module,exports,__dirname,__filename,process,global){var sha=require("./sha");var rng=require("./rng");var algorithms={sha1:{hex:sha.hex_sha1,binary:sha.b64_sha1,ascii:sha.str_sha1}};
function error(){var m=[].slice.call(arguments).join(" ");throw new Error([m,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join("\n"))}exports.createHash=function(alg){alg=alg||"sha1";if(!algorithms[alg])error("algorithm:",alg,"is not yet supported");var s="";var _alg=algorithms[alg];return{update:function(data){s+=data;return this},digest:function(enc){enc=enc||"binary";var fn;if(!(fn=_alg[enc]))error("encoding:",enc,"is not yet supported for algorithm",alg);var r=fn(s);s=null;return r}}};exports.randomBytes=function(size,callback){if(callback&&callback.call){try{callback.call(this,undefined,rng(size))}catch(err){callback(err)}}else{return rng(size)}};["createCredentials","createHmac","createCypher","createCypheriv","createDecipher","createDecipheriv","createSign","createVerify","createDeffieHellman","pbkdf2"].forEach(function(name){exports[name]=function(){error("sorry,",name,"is not implemented yet")}})});require.define("/node_modules/crypto-browserify/sha.js",function(require,module,exports,__dirname,__filename,process,global){exports.hex_sha1=hex_sha1;exports.b64_sha1=b64_sha1;exports.str_sha1=str_sha1;exports.hex_hmac_sha1=hex_hmac_sha1;exports.b64_hmac_sha1=b64_hmac_sha1;exports.str_hmac_sha1=str_hmac_sha1;var hexcase=0;var b64pad="";var chrsz=8;function hex_sha1(s){return binb2hex(core_sha1(str2binb(s),s.length*chrsz))}function b64_sha1(s){return binb2b64(core_sha1(str2binb(s),s.length*chrsz))}function str_sha1(s){return binb2str(core_sha1(str2binb(s),s.length*chrsz))}function hex_hmac_sha1(key,data){return binb2hex(core_hmac_sha1(key,data))}function b64_hmac_sha1(key,data){return binb2b64(core_hmac_sha1(key,data))}function str_hmac_sha1(key,data){return binb2str(core_hmac_sha1(key,data))}function sha1_vm_test(){return hex_sha1("abc")=="a9993e364706816aba3e25717850c26c9cd0d89d"}function core_sha1(x,len){x[len>>5]|=128<<24-len%32;x[(len+64>>9<<4)+15]=len;var w=Array(80);var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;var e=-1009589776;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;var olde=e;for(var j=0;j<80;j++){if(j<16)w[j]=x[i+j];else w[j]=rol(w[j-3]^w[j-8]^w[j-14]^w[j-16],1);var t=safe_add(safe_add(rol(a,5),sha1_ft(j,b,c,d)),safe_add(safe_add(e,w[j]),sha1_kt(j)));e=d;d=c;c=rol(b,30);b=a;a=t}a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd);e=safe_add(e,olde)}return Array(a,b,c,d,e)}function sha1_ft(t,b,c,d){if(t<20)return b&c|~b&d;if(t<40)return b^c^d;if(t<60)return b&c|b&d|c&d;return b^c^d}function sha1_kt(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function core_hmac_sha1(key,data){var bkey=str2binb(key);if(bkey.length>16)bkey=core_sha1(bkey,key.length*chrsz);var ipad=Array(16),opad=Array(16);for(var i=0;i<16;i++){ipad[i]=bkey[i]^909522486;opad[i]=bkey[i]^1549556828}var hash=core_sha1(ipad.concat(str2binb(data)),512+data.length*chrsz);return core_sha1(opad.concat(hash),512+160)}function safe_add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function rol(num,cnt){return num<<cnt|num>>>32-cnt}function str2binb(str){var bin=Array();var mask=(1<<chrsz)-1;for(var i=0;i<str.length*chrsz;i+=chrsz)bin[i>>5]|=(str.charCodeAt(i/chrsz)&mask)<<32-chrsz-i%32;return bin}function binb2str(bin){var str="";var mask=(1<<chrsz)-1;for(var i=0;i<bin.length*32;i+=chrsz)str+=String.fromCharCode(bin[i>>5]>>>32-chrsz-i%32&mask);return str}function binb2hex(binarray){var hex_tab=hexcase?"0123456789ABCDEF":"0123456789abcdef";var str="";for(var i=0;i<binarray.length*4;i++){str+=hex_tab.charAt(binarray[i>>2]>>(3-i%4)*8+4&15)+hex_tab.charAt(binarray[i>>2]>>(3-i%4)*8&15)}return str}function binb2b64(binarray){var tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var str="";for(var i=0;i<binarray.length*4;i+=3){var triplet=(binarray[i>>2]>>8*(3-i%4)&255)<<16|(binarray[i+1>>2]>>8*(3-(i+1)%4)&255)<<8|binarray[i+2>>2]>>8*(3-(i+2)%4)&255;for(var j=0;j<4;j++){if(i*8+j*6>binarray.length*32)str+=b64pad;else str+=tab.charAt(triplet>>6*(3-j)&63)}}return str}});require.define("/node_modules/crypto-browserify/rng.js",function(require,module,exports,__dirname,__filename,process,global){(function(){var _global=this;var mathRNG,whatwgRNG;mathRNG=function(size){var bytes=new Array(size);var r;for(var i=0,r;i<size;i++){if((i&3)==0)r=Math.random()*4294967296;bytes[i]=r>>>((i&3)<<3)&255}return bytes};if(_global.crypto&&crypto.getRandomValues){var _rnds=new Uint32Array(4);whatwgRNG=function(size){var bytes=new Array(size);crypto.getRandomValues(_rnds);for(var c=0;c<size;c++){bytes[c]=_rnds[c>>2]>>>(c&3)*8&255}return bytes}}module.exports=whatwgRNG||mathRNG})()});require.define("buffer",function(require,module,exports,__dirname,__filename,process,global){module.exports=require("buffer-browserify")});require.define("/node_modules/buffer-browserify/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={main:"index.js",browserify:"index.js"}});require.define("/node_modules/buffer-browserify/index.js",function(require,module,exports,__dirname,__filename,process,global){function SlowBuffer(size){this.length=size}var assert=require("assert");exports.INSPECT_MAX_BYTES=50;function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++)if(str.charCodeAt(i)<=127)byteArray.push(str.charCodeAt(i));else{var h=encodeURIComponent(str.charAt(i)).substr(1).split("%");for(var j=0;j<h.length;j++)byteArray.push(parseInt(h[j],16))}return byteArray}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++)byteArray.push(str.charCodeAt(i)&255);return byteArray}function base64ToBytes(str){return require("base64-js").toByteArray(str)}SlowBuffer.byteLength=function(str,encoding){switch(encoding||"utf8"){case"hex":return str.length/2;case"utf8":case"utf-8":return utf8ToBytes(str).length;case"ascii":return str.length;case"base64":return base64ToBytes(str).length;default:throw new Error("Unknown encoding")}};function blitBuffer(src,dst,offset,length){var pos,i=0;while(i<length){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i];i++}return i}SlowBuffer.prototype.utf8Write=function(string,offset,length){var bytes,pos;return SlowBuffer._charsWritten=blitBuffer(utf8ToBytes(string),this,offset,length)};SlowBuffer.prototype.asciiWrite=function(string,offset,length){var bytes,pos;return SlowBuffer._charsWritten=blitBuffer(asciiToBytes(string),this,offset,length)};SlowBuffer.prototype.base64Write=function(string,offset,length){var bytes,pos;return SlowBuffer._charsWritten=blitBuffer(base64ToBytes(string),this,offset,length)};SlowBuffer.prototype.base64Slice=function(start,end){var bytes=Array.prototype.slice.apply(this,arguments);return require("base64-js").fromByteArray(bytes)};function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}SlowBuffer.prototype.utf8Slice=function(){var bytes=Array.prototype.slice.apply(this,arguments);var res="";var tmp="";var i=0;while(i<bytes.length){if(bytes[i]<=127){res+=decodeUtf8Char(tmp)+String.fromCharCode(bytes[i]);tmp=""}else tmp+="%"+bytes[i].toString(16);i++}return res+decodeUtf8Char(tmp)};SlowBuffer.prototype.asciiSlice=function(){var bytes=Array.prototype.slice.apply(this,arguments);var ret="";for(var i=0;i<bytes.length;i++)ret+=String.fromCharCode(bytes[i]);return ret};SlowBuffer.prototype.inspect=function(){var out=[],len=this.length;for(var i=0;i<len;i++){out[i]=toHex(this[i]);if(i==exports.INSPECT_MAX_BYTES){out[i+1]="...";break}}return"<SlowBuffer "+out.join(" ")+">"};SlowBuffer.prototype.hexSlice=function(start,end){var len=this.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;i++){out+=toHex(this[i])}return out};SlowBuffer.prototype.toString=function(encoding,start,end){encoding=String(encoding||"utf8").toLowerCase();start=+start||0;if(typeof end=="undefined")end=this.length;if(+end==start){return""}switch(encoding){case"hex":return this.hexSlice(start,end);case"utf8":case"utf-8":return this.utf8Slice(start,end);case"ascii":return this.asciiSlice(start,end);case"binary":return this.binarySlice(start,end);case"base64":return this.base64Slice(start,end);case"ucs2":case"ucs-2":return this.ucs2Slice(start,end);default:throw new Error("Unknown encoding")}};SlowBuffer.prototype.hexWrite=function(string,offset,length){offset=+offset||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=+length;if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2){throw new Error("Invalid hex string")}if(length>strLen/2){length=strLen/2}for(var i=0;i<length;i++){var byte=parseInt(string.substr(i*2,2),16);if(isNaN(byte))throw new Error("Invalid hex string");this[offset+i]=byte}SlowBuffer._charsWritten=i*2;return i};SlowBuffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset)){if(!isFinite(length)){encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length;length=swap}offset=+offset||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=+length;if(length>remaining){length=remaining}}encoding=String(encoding||"utf8").toLowerCase();switch(encoding){case"hex":return this.hexWrite(string,offset,length);case"utf8":case"utf-8":return this.utf8Write(string,offset,length);case"ascii":return this.asciiWrite(string,offset,length);case"binary":return this.binaryWrite(string,offset,length);case"base64":return this.base64Write(string,offset,length);case"ucs2":case"ucs-2":return this.ucs2Write(string,offset,length);default:throw new Error("Unknown encoding")}};SlowBuffer.prototype.slice=function(start,end){if(end===undefined)end=this.length;if(end>this.length){throw new Error("oob")}if(start>end){throw new Error("oob")}return new Buffer(this,end-start,+start)};SlowBuffer.prototype.copy=function(target,targetstart,sourcestart,sourceend){var temp=[];for(var i=sourcestart;i<sourceend;i++){assert.ok(typeof this[i]!=="undefined","copying undefined buffer bytes!");temp.push(this[i])}for(var i=targetstart;i<targetstart+temp.length;i++){target[i]=temp[i-targetstart]}};function coerce(length){length=~~Math.ceil(+length);return length<0?0:length}function Buffer(subject,encoding,offset){if(!(this instanceof Buffer)){return new Buffer(subject,encoding,offset)}var type;if(typeof offset==="number"){this.length=coerce(encoding);this.parent=subject;this.offset=offset}else{switch(type=typeof subject){case"number":this.length=coerce(subject);break;case"string":this.length=Buffer.byteLength(subject,encoding);break;case"object":this.length=coerce(subject.length);break;default:throw new Error("First argument needs to be a number, "+"array or string.")}if(this.length>Buffer.poolSize){this.parent=new SlowBuffer(this.length);this.offset=0}else{if(!pool||pool.length-pool.used<this.length)allocPool();this.parent=pool;this.offset=pool.used;pool.used+=this.length}if(isArrayIsh(subject)){for(var i=0;i<this.length;i++){this.parent[i+this.offset]=subject[i]}}else if(type=="string"){this.length=this.write(subject,0,encoding)}}}function isArrayIsh(subject){return Array.isArray(subject)||Buffer.isBuffer(subject)||subject&&typeof subject==="object"&&typeof subject.length==="number"}exports.SlowBuffer=SlowBuffer;exports.Buffer=Buffer;Buffer.poolSize=8*1024;var pool;function allocPool(){pool=new SlowBuffer(Buffer.poolSize);pool.used=0}Buffer.isBuffer=function isBuffer(b){return b instanceof Buffer||b instanceof SlowBuffer};Buffer.concat=function(list,totalLength){if(!Array.isArray(list)){throw new Error("Usage: Buffer.concat(list, [totalLength])\n       list should be an Array.")}if(list.length===0){return new Buffer(0)}else if(list.length===1){return list[0]}if(typeof totalLength!=="number"){totalLength=0;for(var i=0;i<list.length;i++){var buf=list[i];totalLength+=buf.length}}var buffer=new Buffer(totalLength);var pos=0;for(var i=0;i<list.length;i++){var buf=list[i];buf.copy(buffer,pos);pos+=buf.length}return buffer};Buffer.prototype.inspect=function inspect(){var out=[],len=this.length;for(var i=0;i<len;i++){out[i]=toHex(this.parent[i+this.offset]);if(i==exports.INSPECT_MAX_BYTES){out[i+1]="...";break}}return"<Buffer "+out.join(" ")+">"};Buffer.prototype.get=function get(i){if(i<0||i>=this.length)throw new Error("oob");return this.parent[this.offset+i]};Buffer.prototype.set=function set(i,v){if(i<0||i>=this.length)throw new Error("oob");return this.parent[this.offset+i]=v};Buffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset)){if(!isFinite(length)){encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length;length=swap}offset=+offset||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=+length;if(length>remaining){length=remaining}}encoding=String(encoding||"utf8").toLowerCase();var ret;switch(encoding){case"hex":ret=this.parent.hexWrite(string,this.offset+offset,length);break;case"utf8":case"utf-8":ret=this.parent.utf8Write(string,this.offset+offset,length);break;case"ascii":ret=this.parent.asciiWrite(string,this.offset+offset,length);break;case"binary":ret=this.parent.binaryWrite(string,this.offset+offset,length);break;case"base64":ret=this.parent.base64Write(string,this.offset+offset,length);break;case"ucs2":case"ucs-2":ret=this.parent.ucs2Write(string,this.offset+offset,length);break;default:throw new Error("Unknown encoding")}Buffer._charsWritten=SlowBuffer._charsWritten;return ret};Buffer.prototype.toString=function(encoding,start,end){encoding=String(encoding||"utf8").toLowerCase();if(typeof start=="undefined"||start<0){start=0}else if(start>this.length){start=this.length}if(typeof end=="undefined"||end>this.length){end=this.length}else if(end<0){end=0}start=start+this.offset;end=end+this.offset;switch(encoding){case"hex":return this.parent.hexSlice(start,end);case"utf8":case"utf-8":return this.parent.utf8Slice(start,end);case"ascii":return this.parent.asciiSlice(start,end);case"binary":return this.parent.binarySlice(start,end);case"base64":return this.parent.base64Slice(start,end);case"ucs2":case"ucs-2":return this.parent.ucs2Slice(start,end);default:throw new Error("Unknown encoding")}};Buffer.byteLength=SlowBuffer.byteLength;Buffer.prototype.fill=function fill(value,start,end){value||(value=0);start||(start=0);end||(end=this.length);if(typeof value==="string"){value=value.charCodeAt(0)}if(!(typeof value==="number")||isNaN(value)){throw new Error("value is not a number")}if(end<start)throw new Error("end < start");if(end===start)return 0;if(this.length==0)return 0;if(start<0||start>=this.length){throw new Error("start out of bounds")}if(end<0||end>this.length){throw new Error("end out of bounds")}return this.parent.fill(value,start+this.offset,end+this.offset)};Buffer.prototype.copy=function(target,target_start,start,end){var source=this;start||(start=0);end||(end=this.length);target_start||(target_start=0);if(end<start)throw new Error("sourceEnd < sourceStart");if(end===start)return 0;if(target.length==0||source.length==0)return 0;if(target_start<0||target_start>=target.length){throw new Error("targetStart out of bounds")}if(start<0||start>=source.length){throw new Error("sourceStart out of bounds")}if(end<0||end>source.length){throw new Error("sourceEnd out of bounds")}if(end>this.length){end=this.length}if(target.length-target_start<end-start){end=target.length-target_start+start}return this.parent.copy(target.parent,target_start+target.offset,start+this.offset,end+this.offset)};Buffer.prototype.slice=function(start,end){if(end===undefined)end=this.length;if(end>this.length)throw new Error("oob");if(start>end)throw new Error("oob");return new Buffer(this.parent,end-start,+start+this.offset)};Buffer.prototype.utf8Slice=function(start,end){return this.toString("utf8",start,end)};Buffer.prototype.binarySlice=function(start,end){return this.toString("binary",start,end)};Buffer.prototype.asciiSlice=function(start,end){return this.toString("ascii",start,end)};Buffer.prototype.utf8Write=function(string,offset){return this.write(string,offset,"utf8")};Buffer.prototype.binaryWrite=function(string,offset){return this.write(string,offset,"binary")};Buffer.prototype.asciiWrite=function(string,offset){return this.write(string,offset,"ascii")};Buffer.prototype.readUInt8=function(offset,noAssert){var buffer=this;if(!noAssert){assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"Trying to read beyond buffer length")}return buffer.parent[buffer.offset+offset]};function readUInt16(buffer,offset,isBigEndian,noAssert){var val=0;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"Trying to read beyond buffer length")}if(isBigEndian){val=buffer.parent[buffer.offset+offset]<<8;val|=buffer.parent[buffer.offset+offset+1]}else{val=buffer.parent[buffer.offset+offset];val|=buffer.parent[buffer.offset+offset+1]<<8}return val}Buffer.prototype.readUInt16LE=function(offset,noAssert){return readUInt16(this,offset,false,noAssert)};Buffer.prototype.readUInt16BE=function(offset,noAssert){return readUInt16(this,offset,true,noAssert)};function readUInt32(buffer,offset,isBigEndian,noAssert){var val=0;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to read beyond buffer length")}if(isBigEndian){val=buffer.parent[buffer.offset+offset+1]<<16;val|=buffer.parent[buffer.offset+offset+2]<<8;val|=buffer.parent[buffer.offset+offset+3];val=val+(buffer.parent[buffer.offset+offset]<<24>>>0)}else{val=buffer.parent[buffer.offset+offset+2]<<16;val|=buffer.parent[buffer.offset+offset+1]<<8;val|=buffer.parent[buffer.offset+offset];val=val+(buffer.parent[buffer.offset+offset+3]<<24>>>0)}return val}Buffer.prototype.readUInt32LE=function(offset,noAssert){return readUInt32(this,offset,false,noAssert)};Buffer.prototype.readUInt32BE=function(offset,noAssert){return readUInt32(this,offset,true,noAssert)};Buffer.prototype.readInt8=function(offset,noAssert){var buffer=this;var neg;if(!noAssert){assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"Trying to read beyond buffer length")}neg=buffer.parent[buffer.offset+offset]&128;if(!neg){return buffer.parent[buffer.offset+offset]}return(255-buffer.parent[buffer.offset+offset]+1)*-1};function readInt16(buffer,offset,isBigEndian,noAssert){var neg,val;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"Trying to read beyond buffer length")}val=readUInt16(buffer,offset,isBigEndian,noAssert);neg=val&32768;if(!neg){return val}return(65535-val+1)*-1}Buffer.prototype.readInt16LE=function(offset,noAssert){return readInt16(this,offset,false,noAssert)};Buffer.prototype.readInt16BE=function(offset,noAssert){return readInt16(this,offset,true,noAssert)};function readInt32(buffer,offset,isBigEndian,noAssert){var neg,val;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to read beyond buffer length")}val=readUInt32(buffer,offset,isBigEndian,noAssert);neg=val&2147483648;if(!neg){return val}return(4294967295-val+1)*-1}Buffer.prototype.readInt32LE=function(offset,noAssert){return readInt32(this,offset,false,noAssert)};Buffer.prototype.readInt32BE=function(offset,noAssert){return readInt32(this,offset,true,noAssert)};function readFloat(buffer,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset+3<buffer.length,"Trying to read beyond buffer length")}return require("./buffer_ieee754").readIEEE754(buffer,offset,isBigEndian,23,4)}Buffer.prototype.readFloatLE=function(offset,noAssert){return readFloat(this,offset,false,noAssert)};Buffer.prototype.readFloatBE=function(offset,noAssert){return readFloat(this,offset,true,noAssert)};function readDouble(buffer,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset+7<buffer.length,"Trying to read beyond buffer length")}return require("./buffer_ieee754").readIEEE754(buffer,offset,isBigEndian,52,8)}Buffer.prototype.readDoubleLE=function(offset,noAssert){return readDouble(this,offset,false,noAssert)};Buffer.prototype.readDoubleBE=function(offset,noAssert){return readDouble(this,offset,true,noAssert)};function verifuint(value,max){assert.ok(typeof value=="number","cannot write a non-number as a number");assert.ok(value>=0,"specified a negative value for writing an unsigned value");assert.ok(value<=max,"value is larger than maximum value for type");assert.ok(Math.floor(value)===value,"value has a fractional component")}Buffer.prototype.writeUInt8=function(value,offset,noAssert){var buffer=this;if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"trying to write beyond buffer length");verifuint(value,255)}buffer.parent[buffer.offset+offset]=value};function writeUInt16(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"trying to write beyond buffer length");verifuint(value,65535)}if(isBigEndian){buffer.parent[buffer.offset+offset]=(value&65280)>>>8;buffer.parent[buffer.offset+offset+1]=value&255}else{buffer.parent[buffer.offset+offset+1]=(value&65280)>>>8;buffer.parent[buffer.offset+offset]=value&255}}Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){writeUInt16(this,value,offset,false,noAssert)};Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){writeUInt16(this,value,offset,true,noAssert)};function writeUInt32(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"trying to write beyond buffer length");verifuint(value,4294967295)}if(isBigEndian){buffer.parent[buffer.offset+offset]=value>>>24&255;buffer.parent[buffer.offset+offset+1]=value>>>16&255;buffer.parent[buffer.offset+offset+2]=value>>>8&255;buffer.parent[buffer.offset+offset+3]=value&255}else{buffer.parent[buffer.offset+offset+3]=value>>>24&255;buffer.parent[buffer.offset+offset+2]=value>>>16&255;buffer.parent[buffer.offset+offset+1]=value>>>8&255;buffer.parent[buffer.offset+offset]=value&255}}Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){writeUInt32(this,value,offset,false,noAssert)};Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){writeUInt32(this,value,offset,true,noAssert)};function verifsint(value,max,min){assert.ok(typeof value=="number","cannot write a non-number as a number");assert.ok(value<=max,"value larger than maximum allowed value");assert.ok(value>=min,"value smaller than minimum allowed value");assert.ok(Math.floor(value)===value,"value has a fractional component")}function verifIEEE754(value,max,min){assert.ok(typeof value=="number","cannot write a non-number as a number");assert.ok(value<=max,"value larger than maximum allowed value");assert.ok(value>=min,"value smaller than minimum allowed value")}Buffer.prototype.writeInt8=function(value,offset,noAssert){var buffer=this;if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"Trying to write beyond buffer length");verifsint(value,127,-128)}if(value>=0){buffer.writeUInt8(value,offset,noAssert)}else{buffer.writeUInt8(255+value+1,offset,noAssert)}};function writeInt16(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"Trying to write beyond buffer length");verifsint(value,32767,-32768)}if(value>=0){writeUInt16(buffer,value,offset,isBigEndian,noAssert)}else{writeUInt16(buffer,65535+value+1,offset,isBigEndian,noAssert)}}Buffer.prototype.writeInt16LE=function(value,offset,noAssert){writeInt16(this,value,offset,false,noAssert)};Buffer.prototype.writeInt16BE=function(value,offset,noAssert){writeInt16(this,value,offset,true,noAssert)};function writeInt32(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to write beyond buffer length");verifsint(value,2147483647,-2147483648)}if(value>=0){writeUInt32(buffer,value,offset,isBigEndian,noAssert)}else{writeUInt32(buffer,4294967295+value+1,offset,isBigEndian,noAssert)}}Buffer.prototype.writeInt32LE=function(value,offset,noAssert){writeInt32(this,value,offset,false,noAssert)};Buffer.prototype.writeInt32BE=function(value,offset,noAssert){writeInt32(this,value,offset,true,noAssert)};function writeFloat(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to write beyond buffer length");verifIEEE754(value,3.4028234663852886e38,-3.4028234663852886e38)}require("./buffer_ieee754").writeIEEE754(buffer,value,offset,isBigEndian,23,4)}Buffer.prototype.writeFloatLE=function(value,offset,noAssert){writeFloat(this,value,offset,false,noAssert)};Buffer.prototype.writeFloatBE=function(value,offset,noAssert){writeFloat(this,value,offset,true,noAssert)};function writeDouble(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+7<buffer.length,"Trying to write beyond buffer length");verifIEEE754(value,1.7976931348623157e308,-1.7976931348623157e308)}require("./buffer_ieee754").writeIEEE754(buffer,value,offset,isBigEndian,52,8)}Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){writeDouble(this,value,offset,true,noAssert)};SlowBuffer.prototype.readUInt8=Buffer.prototype.readUInt8;SlowBuffer.prototype.readUInt16LE=Buffer.prototype.readUInt16LE;SlowBuffer.prototype.readUInt16BE=Buffer.prototype.readUInt16BE;SlowBuffer.prototype.readUInt32LE=Buffer.prototype.readUInt32LE;SlowBuffer.prototype.readUInt32BE=Buffer.prototype.readUInt32BE;SlowBuffer.prototype.readInt8=Buffer.prototype.readInt8;SlowBuffer.prototype.readInt16LE=Buffer.prototype.readInt16LE;SlowBuffer.prototype.readInt16BE=Buffer.prototype.readInt16BE;SlowBuffer.prototype.readInt32LE=Buffer.prototype.readInt32LE;SlowBuffer.prototype.readInt32BE=Buffer.prototype.readInt32BE;SlowBuffer.prototype.readFloatLE=Buffer.prototype.readFloatLE;SlowBuffer.prototype.readFloatBE=Buffer.prototype.readFloatBE;SlowBuffer.prototype.readDoubleLE=Buffer.prototype.readDoubleLE;SlowBuffer.prototype.readDoubleBE=Buffer.prototype.readDoubleBE;SlowBuffer.prototype.writeUInt8=Buffer.prototype.writeUInt8;SlowBuffer.prototype.writeUInt16LE=Buffer.prototype.writeUInt16LE;SlowBuffer.prototype.writeUInt16BE=Buffer.prototype.writeUInt16BE;SlowBuffer.prototype.writeUInt32LE=Buffer.prototype.writeUInt32LE;SlowBuffer.prototype.writeUInt32BE=Buffer.prototype.writeUInt32BE;SlowBuffer.prototype.writeInt8=Buffer.prototype.writeInt8;SlowBuffer.prototype.writeInt16LE=Buffer.prototype.writeInt16LE;SlowBuffer.prototype.writeInt16BE=Buffer.prototype.writeInt16BE;SlowBuffer.prototype.writeInt32LE=Buffer.prototype.writeInt32LE;SlowBuffer.prototype.writeInt32BE=Buffer.prototype.writeInt32BE;SlowBuffer.prototype.writeFloatLE=Buffer.prototype.writeFloatLE;SlowBuffer.prototype.writeFloatBE=Buffer.prototype.writeFloatBE;SlowBuffer.prototype.writeDoubleLE=Buffer.prototype.writeDoubleLE;SlowBuffer.prototype.writeDoubleBE=Buffer.prototype.writeDoubleBE});require.define("assert",function(require,module,exports,__dirname,__filename,process,global){var util=require("util");var Buffer=require("buffer").Buffer;var pSlice=Array.prototype.slice;var assert=module.exports=ok;assert.AssertionError=function AssertionError(options){this.name="AssertionError";this.message=options.message;this.actual=options.actual;this.expected=options.expected;this.operator=options.operator;var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace){Error.captureStackTrace(this,stackStartFunction)}};util.inherits(assert.AssertionError,Error);function replacer(key,value){if(value===undefined){return""+value}if(typeof value==="number"&&(isNaN(value)||!isFinite(value))){return value.toString()}if(typeof value==="function"||value instanceof RegExp){return value.toString()}return value}function truncate(s,n){if(typeof s=="string"){return s.length<n?s:s.slice(0,n)}else{return s}}assert.AssertionError.prototype.toString=function(){if(this.message){return[this.name+":",this.message].join(" ")}else{return[this.name+":",truncate(JSON.stringify(this.actual,replacer),128),this.operator,truncate(JSON.stringify(this.expected,replacer),128)].join(" ")}};assert.AssertionError.__proto__=Error.prototype;function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}assert.fail=fail;function ok(value,message){if(!!!value)fail(value,true,message,"==",assert.ok)}assert.ok=ok;assert.equal=function equal(actual,expected,message){if(actual!=expected)fail(actual,expected,message,"==",assert.equal)};assert.notEqual=function notEqual(actual,expected,message){if(actual==expected){fail(actual,expected,message,"!=",assert.notEqual)}};assert.deepEqual=function deepEqual(actual,expected,message){if(!_deepEqual(actual,expected)){fail(actual,expected,message,"deepEqual",assert.deepEqual)}};function _deepEqual(actual,expected){if(actual===expected){return true}else if(Buffer.isBuffer(actual)&&Buffer.isBuffer(expected)){if(actual.length!=expected.length)return false;for(var i=0;i<actual.length;i++){if(actual[i]!==expected[i])return false}return true}else if(actual instanceof Date&&expected instanceof Date){return actual.getTime()===expected.getTime()}else if(typeof actual!="object"&&typeof expected!="object"){return actual==expected}else{return objEquiv(actual,expected)}}function isUndefinedOrNull(value){return value===null||value===undefined}function isArguments(object){return Object.prototype.toString.call(object)=="[object Arguments]"}function objEquiv(a,b){if(isUndefinedOrNull(a)||isUndefinedOrNull(b))return false;if(a.prototype!==b.prototype)return false;if(isArguments(a)){if(!isArguments(b)){return false}a=pSlice.call(a);b=pSlice.call(b);return _deepEqual(a,b)}try{var ka=Object.keys(a),kb=Object.keys(b),key,i}catch(e){return false}if(ka.length!=kb.length)return false;ka.sort();kb.sort();for(i=ka.length-1;i>=0;i--){if(ka[i]!=kb[i])return false}for(i=ka.length-1;i>=0;i--){key=ka[i];if(!_deepEqual(a[key],b[key]))return false
}return true}assert.notDeepEqual=function notDeepEqual(actual,expected,message){if(_deepEqual(actual,expected)){fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)}};assert.strictEqual=function strictEqual(actual,expected,message){if(actual!==expected){fail(actual,expected,message,"===",assert.strictEqual)}};assert.notStrictEqual=function notStrictEqual(actual,expected,message){if(actual===expected){fail(actual,expected,message,"!==",assert.notStrictEqual)}};function expectedException(actual,expected){if(!actual||!expected){return false}if(expected instanceof RegExp){return expected.test(actual)}else if(actual instanceof expected){return true}else if(expected.call({},actual)===true){return true}return false}function _throws(shouldThrow,block,expected,message){var actual;if(typeof expected==="string"){message=expected;expected=null}try{block()}catch(e){actual=e}message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:".");if(shouldThrow&&!actual){fail("Missing expected exception"+message)}if(!shouldThrow&&expectedException(actual,expected)){fail("Got unwanted exception"+message)}if(shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual){throw actual}}assert.throws=function(block,error,message){_throws.apply(this,[true].concat(pSlice.call(arguments)))};assert.doesNotThrow=function(block,error,message){_throws.apply(this,[false].concat(pSlice.call(arguments)))};assert.ifError=function(err){if(err){throw err}}});require.define("/node_modules/buffer-browserify/node_modules/base64-js/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={main:"lib/b64.js"}});require.define("/node_modules/buffer-browserify/node_modules/base64-js/lib/b64.js",function(require,module,exports,__dirname,__filename,process,global){(function(exports){"use strict";var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function b64ToByteArray(b64){var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0){throw"Invalid string. Length must be a multiple of 4"}placeHolders=b64.indexOf("=");placeHolders=placeHolders>0?b64.length-placeHolders:0;arr=[];l=placeHolders>0?b64.length-4:b64.length;for(i=0,j=0;i<l;i+=4,j+=3){tmp=lookup.indexOf(b64[i])<<18|lookup.indexOf(b64[i+1])<<12|lookup.indexOf(b64[i+2])<<6|lookup.indexOf(b64[i+3]);arr.push((tmp&16711680)>>16);arr.push((tmp&65280)>>8);arr.push(tmp&255)}if(placeHolders===2){tmp=lookup.indexOf(b64[i])<<2|lookup.indexOf(b64[i+1])>>4;arr.push(tmp&255)}else if(placeHolders===1){tmp=lookup.indexOf(b64[i])<<10|lookup.indexOf(b64[i+1])<<4|lookup.indexOf(b64[i+2])>>2;arr.push(tmp>>8&255);arr.push(tmp&255)}return arr}function uint8ToBase64(uint8){var i,extraBytes=uint8.length%3,output="",temp,length;function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}for(i=0,length=uint8.length-extraBytes;i<length;i+=3){temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output+=tripletToBase64(temp)}switch(extraBytes){case 1:temp=uint8[uint8.length-1];output+=lookup[temp>>2];output+=lookup[temp<<4&63];output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1];output+=lookup[temp>>10];output+=lookup[temp>>4&63];output+=lookup[temp<<2&63];output+="=";break}return output}module.exports.toByteArray=b64ToByteArray;module.exports.fromByteArray=uint8ToBase64})()});require.define("/node_modules/buffer-browserify/buffer_ieee754.js",function(require,module,exports,__dirname,__filename,process,global){exports.readIEEE754=function(buffer,offset,isBE,mLen,nBytes){var e,m,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isBE?0:nBytes-1,d=isBE?1:-1,s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8);m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8);if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.writeIEEE754=function(buffer,value,offset,isBE,mLen,nBytes){var e,m,c,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0,i=isBE?nBytes-1:0,d=isBE?-1:1,s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8);e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=s*128}});require.define("/schema.js",function(require,module,exports,__dirname,__filename,process,global){function create(con){return function(){return new con}}module.exports={model:create(require("scuttlebutt/model")),events:create(require("scuttlebutt/events")),"r-edit":create(require("r-edit")),"r-array":create(require("r-array")),crdt:create(require("crdt")),"append-only":create(require("append-only")),"expiry-model":create(require("expiry-model"))}});require.define("/node_modules/scuttlebutt/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={}});require.define("/node_modules/scuttlebutt/model.js",function(require,module,exports,__dirname,__filename,process,global){var Scuttlebutt=require("./index");var inherits=require("util").inherits;var each=require("iterate").each;var u=require("./util");module.exports=Model;inherits(Model,Scuttlebutt);function Model(opts){if(!(this instanceof Model))return new Model(opts);Scuttlebutt.call(this,opts);this.store={}}var m=Model.prototype;m.set=function(k,v){this.localUpdate([k,v]);return this};m.get=function(k){if(this.store[k])return this.store[k][0][1]};m.applyUpdate=function(update){var key=update[0][0];if("undefined"!==typeof this.store[key]&&this.store[key][1]>update[1])return this.emit("_remove",update);if(this.store[key])this.emit("_remove",this.store[key]);this.store[key]=update;this.emit.apply(this,["update"].concat(update));this.emit("change",key,update[0][1]);this.emit("change:"+key,update[0][1]);return true};m.history=function(sources){var self=this;var h=[];each(this.store,function(e){if(u.filter(e,sources))h.push(e)});return h};m.toJSON=function(){var o={};for(var k in this.store)o[k]=this.get(k);return o}});require.define("/node_modules/scuttlebutt/index.js",function(require,module,exports,__dirname,__filename,process,global){var EventEmitter=require("events").EventEmitter;var i=require("iterate");var duplex=require("duplex");var inherits=require("util").inherits;var serializer=require("stream-serializer");var u=require("./util");var timestamp=require("monotonic-timestamp");exports=module.exports=Scuttlebutt;exports.createID=u.createID;exports.updateIsRecent=u.filter;exports.filter=u.filter;exports.timestamp=timestamp;function dutyOfSubclass(){throw new Error("method must be implemented by subclass")}function validate(data){var ts=data[1],source=data[2];if(!Array.isArray(data)||"string"!==typeof source||"number"!==typeof ts)return false;return true}var emit=EventEmitter.prototype.emit;inherits(Scuttlebutt,EventEmitter);function Scuttlebutt(opts){if(!(this instanceof Scuttlebutt))return new Scuttlebutt(opts);var id="string"===typeof opts?opts:opts&&opts.id;this.sources={};this.setMaxListeners(Number.MAX_VALUE);this._streams=0;if(opts&&opts.sign&&opts.verify){this.id=opts.id||opts.createId();this._sign=opts.sign;this._verify=opts.verify}else{this.id=id||u.createId()}}var sb=Scuttlebutt.prototype;var emit=EventEmitter.prototype.emit;sb.applyUpdate=dutyOfSubclass;sb.history=dutyOfSubclass;sb.localUpdate=function(trx){this._update([trx,timestamp(),this.id]);return this};sb._update=function(update){var ts=update[1];var source=update[2];var latest=this.sources[source];if(latest&&latest>=ts)return emit.call(this,"old_data",update),false;this.sources[source]=ts;var self=this;function didVerification(err,verified){if(err)return emit.call(self,"error",err);if(!verified)return emit.call(self,"unverified_data",update);if(self.applyUpdate(update))emit.call(self,"_update",update)}if(source!==this.id){if(this._verify)this._verify(update,didVerification);else didVerification(null,true)}else{if(this._sign){update[3]=this._sign(update)}didVerification(null,true)}return true};sb.createStream=function(opts){var self=this;var sources={},other;var syncSent=false,syncRecv=false;this._streams++;opts=opts||{};var d=duplex();d.name=opts.name;var outer=serializer(opts&&opts.wrapper)(d);outer.inner=d;d.writable=opts.writable!==false;d.readable=opts.readable!==false;syncRecv=!d.writable;syncSent=!d.readable;var tail=opts.tail!==false;function start(data){sources=data.clock;i.each(self.history(sources),function(data){d._data(data)});outer.emit("header",data);d._data("SYNC");outer.emit("syncSent");syncSent=true;if(syncRecv)outer.emit("sync"),outer.emit("synced");if(!tail)d._end()}d.on("_data",function(data){if(Array.isArray(data)){if(validate(data))return self._update(data)}else if("object"===typeof data&&data)start(data);else if("string"===typeof data&&data=="SYNC"){syncRecv=true;outer.emit("syncRecieved");if(syncSent)outer.emit("sync"),outer.emit("synced")}}).on("_end",function(){d._end()}).on("close",function(){self.removeListener("_update",onUpdate);self._streams--;emit.call(self,"unstream",self._streams)});if(opts&&opts.tail===false){outer.on("sync",function(){process.nextTick(function(){d._end()})})}function onUpdate(update){if(!u.filter(update,sources))return;d._data(update);var ts=update[1];var source=update[2];sources[source]=ts}var outgoing={id:self.id,clock:self.sources};if(opts&&opts.meta)outgoing.meta=opts.meta;if(d.readable){d._data(outgoing);if(!d.writable)start({clock:{}});if(tail)self.on("_update",onUpdate)}self.once("dispose",function(){d.end()});return outer};sb.createWriteStream=function(opts){opts=opts||{};opts.writable=true;opts.readable=false;return this.createStream(opts)};sb.createReadStream=function(opts){opts=opts||{};opts.writable=false;opts.readable=true;return this.createStream(opts)};sb.dispose=function(){emit.call(this,"dispose")};sb.setId=function(id){this.id=id;return this};sb.clone=function(){var A=this;var B=new A.constructor;B.setId(A.id);var a=A.createStream({wrapper:"raw"});var b=B.createStream({wrapper:"raw"});a.pause=b.pause=function noop(){};a.pipe(b).pipe(a);a.resume();b.resume();return B}});require.define("/node_modules/scuttlebutt/node_modules/iterate/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={main:"index.js"}});require.define("/node_modules/scuttlebutt/node_modules/iterate/index.js",function(require,module,exports,__dirname,__filename,process,global){var each=exports.each=function(obj,iterator){var keys=Object.keys(obj);keys.forEach(function(key){iterator(obj[key],key,obj)})};var RX=/sadf/.constructor;function rx(iterator){return iterator instanceof RX?function(str){var m=iterator.exec(str);return m&&(m[1]?m[1]:m[0])}:iterator}var times=exports.times=function(){var args=[].slice.call(arguments),iterator=rx(args.pop()),m=args.pop(),i=args.shift(),j=args.shift(),diff,dir,a=[];i="number"===typeof i?i:1;diff=j?j-i:1;dir=i<m;if(m==i)throw new Error("steps cannot be the same: "+m+", "+i);for(;dir?i<=m:m<=i;i+=diff)a.push(iterator(i));return a};var map=exports.map=function(obj,iterator){iterator=rx(iterator);if(Array.isArray(obj))return obj.map(iterator);if("number"===typeof obj)return times.apply(null,[].slice.call(arguments));var keys=Object.keys(obj),r={};keys.forEach(function(key){r[key]=iterator(obj[key],key,obj)});return r};var findReturn=exports.findReturn=function(obj,iterator){iterator=rx(iterator);if(obj==null)return;var keys=Object.keys(obj),l=keys.length;for(var i=0;i<l;i++){var key=keys[i],value=obj[key];var r=iterator(value,key);if(r)return r}};var find=exports.find=function(obj,iterator){iterator=rx(iterator);return findReturn(obj,function(v,k){var r=iterator(v,k);if(r)return v})};var findKey=exports.findKey=function(obj,iterator){iterator=rx(iterator);return findReturn(obj,function(v,k){var r=iterator(v,k);if(r)return k})};var filter=exports.filter=function(obj,iterator){iterator=rx(iterator);if(Array.isArray(obj))return obj.filter(iterator);var keys=Object.keys(obj),r={};keys.forEach(function(key){var v;if(iterator(v=obj[key],key,obj))r[key]=v});return r};var mapKeys=exports.mapKeys=function(ary,iterator){var r={};iterator=rx(iterator);each(ary,function(v,k){r[v]=iterator(v,k)});return r};var mapToArray=exports.mapToArray=function(ary,iterator){var r=[];iterator=rx(iterator);each(ary,function(v,k){r.push(iterator(v,k))});return r};var path=exports.path=function(object,path){for(var i in path){if(object==null)return undefined;var key=path[i];object=object[key]}return object};var setPath=exports.setPath=function(object,path,value){for(var i in path){var key=path[i];if(object[key]==null)object[key]=i+1==path.length?value:{};object=object[key]}}});require.define("/node_modules/scuttlebutt/util.js",function(require,module,exports,__dirname,__filename,process,global){exports.createId=function(){return[1,1,1].map(function(){return Math.random().toString(16).substring(2).toUpperCase()}).join("")};exports.filter=function(update,sources){var ts=update[1];var source=update[2];return!sources||!sources[source]||sources[source]<ts}});require.define("/node_modules/scuttlebutt/node_modules/monotonic-timestamp/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={}});require.define("/node_modules/scuttlebutt/node_modules/monotonic-timestamp/index.js",function(require,module,exports,__dirname,__filename,process,global){var _last=0;var _count=1;var LAST;module.exports=function(){var t=Date.now();var _t=t;if(_last==t){_t+=_count++/1e3}else _count=1;_last=t;if(_t===LAST)throw new Error("LAST:"+LAST+","+_t);LAST=_t;return _t}});require.define("/node_modules/scuttlebutt/events.js",function(require,module,exports,__dirname,__filename,process,global){var Scuttlebutt=require("./");var inherits=require("util").inherits;var each=require("iterate").each;var u=require("./util");var EventEmitter=require("events").EventEmitter;module.exports=ReliableEventEmitter;inherits(ReliableEventEmitter,Scuttlebutt);function ReliableEventEmitter(opts){if(!(this instanceof ReliableEventEmitter))return new ReliableEventEmitter(opts);Scuttlebutt.call(this,opts)}var emit=EventEmitter.prototype.emit;var emitter=ReliableEventEmitter.prototype;emitter.emit=function(event){var args=[].slice.call(arguments);if(event=="newListener")return emit.apply(this,args);return this.localUpdate(args)};emitter.applyUpdate=function(update){var key=update[0][0];this.events=this.events||{};this.events[key]=this.events[key]||[];this.events[key].push(update);emit.apply(this,update[0]);return true};emitter.history=function(filter){var self=this;var h=[];this.events=this.events||{};each(this.events,function(es){each(es,function(e){if(u.filter(e,filter))h.push(e)})});return h.sort(function(a,b){return a[1]-b[1]})}});require.define("/node_modules/r-edit/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={}});require.define("/node_modules/r-edit/index.js",function(require,module,exports,__dirname,__filename,process,global){var diff=require("adiff").diff;var RArray=require("r-array");var inherits=require("util").inherits;function patch(a,changes){changes.forEach(function(patch){a.splice.apply(a,patch)});return a}function split(str){return str.split("\n").map(function(l,i,a){if(i!=a.length-1)return l+"\n";return l})}module.exports=REdit;inherits(REdit,RArray);function REdit(){if(!(this instanceof REdit))return new REdit;RArray.call(this)}var R=REdit.prototype;R.text=function text(text){if(!arguments.length)return this.toJSON().join("");var old=this.toJSON();text=split(text);var p=diff(old,text);patch(this,p)};R.unwrap=function(){};R.wrap=function(ta){if(!ta)throw new Error("wrap(ta) expects TextArea, or Input");var cursor=0,start;var self=this;if(this.wrapped)throw new Error("rEdit is already wrapping a textarea. unwrap it first!");if(ta._rEditWrapper)ta._rEditWrapper.unwrap();ta._rEditWrapper=this;this.wrapped=ta;ta.value=this.text();function onPreupdate(ch){cursor=0;start=ta.selectionStart;end=ta.selectionEnd;var startKey,sum=0;for(var i in self.keys){var key=self.keys[i];if((sum=self.store[key].length+sum)>=start){startKey=key;break}}for(var key in ch){if(key<startKey)cursor+=(ch[key]?ch[key].length:0)-(self.store[key]?self.store[key].length:0)}start=start+cursor;end=end+cursor}this.on("preupdate",onPreupdate);function on_update(update){if(update[2]!==self.id){ta.value=self.toJSON().join("");ta.selectionStart=ta.selectionEnd=start}}this.on("_update",on_update);var pending=false;function onInput(){self.text(ta.value)}function onKeydown(){start=ta.selectionStart;end=ta.selectionEnd}function onFocus(){ta.selectionStart=ta.selectionEnd=start}ta.addEventListener("input",onInput);ta.addEventListener("keydown",onKeydown);ta.addEventListener("focus",onFocus);this.unwrap=function(){ta.removeEventListener("input",onInput);ta.removeEventListener("keydown",onKeydown);ta.removeEventListener("focus",onFocus);this.removeListener("preupdate",onPreupdate);this.removeListener("_update",on_update);this.unwrap=function(){}};return this}});require.define("/node_modules/r-edit/node_modules/adiff/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={main:"./index.js"}});require.define("/node_modules/r-edit/node_modules/adiff/index.js",function(require,module,exports,__dirname,__filename,process,global){function head(a){return a[0]}function last(a){return a[a.length-1]}function tail(a){return a.slice(1)}function retreat(e){return e.pop()}function hasLength(e){return e.length}function any(ary,test){for(var i in ary)if(test(ary[i]))return true;return false}var _rules;function _equal(a,b){if(a&&!b)return false;if(Array.isArray(a))if(a.length!=b.length)return false;if(a&&"object"==typeof a){for(var i in a)if(!_equal(a[i],b[i]))return false;return true}return a==b}function getArgs(args){return args.length==1?args[0]:[].slice.call(args)}function oddElement(ary,cmp){var c;function guess(a){var odd=-1;c=0;for(var i=a;i<ary.length;i++){if(!cmp(ary[a],ary[i])){odd=i,c++}}return c>1?-1:odd}var g=guess(0);if(-1!=g)return g;guess(1);return c==0?0:-1}var exports=module.exports=function(deps,exports){var equal=deps&&deps.equal||_equal;exports=exports||{};exports.lcs=function lcs(){var cache={};var args=getArgs(arguments);var a=args[0],b=args[1];function key(a,b){return a.length+":"+b.length}if(args.length>2){args.push(lcs(args.shift(),args.shift()));return lcs(args)}var start=0,end=0;for(var i=0;i<a.length&&i<b.length&&equal(a[i],b[i]);i++)start=i+1;if(a.length===start)return a.slice();for(var i=0;i<a.length-start&&i<b.length-start&&equal(a[a.length-1-i],b[b.length-1-i]);i++)end=i;function recurse(a,b){if(!a.length||!b.length)return[];if(cache[key(a,b)])return cache[key(a,b)];if(equal(a[0],b[0]))return[head(a)].concat(recurse(tail(a),tail(b)));else{var _a=recurse(tail(a),b);var _b=recurse(a,tail(b));return cache[key(a,b)]=_a.length>_b.length?_a:_b}}var middleA=a.slice(start,a.length-end);var middleB=b.slice(start,b.length-end);return a.slice(0,start).concat(recurse(middleA,middleB)).concat(a.slice(a.length-end))};exports.chunk=function(q,build){var q=q.map(function(e){return e.slice()});var lcs=exports.lcs.apply(null,q);var all=[lcs].concat(q);function matchLcs(e){if(e.length&&!lcs.length||!e.length&&lcs.length)return false;return equal(last(e),last(lcs))||e.length+lcs.length===0}while(any(q,hasLength)){while(q.every(matchLcs)&&q.every(hasLength))all.forEach(retreat);var c=false;var unstable=q.map(function(e){var change=[];while(!matchLcs(e)){change.unshift(retreat(e));c=true}return change});if(c)build(q[0].length,unstable)}};exports.diff=function(a,b){var changes=[];exports.chunk([a,b],function(index,unstable){var del=unstable.shift().length;var insert=unstable.shift();changes.push([index,del].concat(insert))});return changes};exports.patch=function(a,changes,mutate){if(mutate!==true)a=a.slice(a);changes.forEach(function(change){[].splice.apply(a,change)});return a};exports.merge=function(){var args=getArgs(arguments);var patch=exports.diff3(args);return exports.patch(args[0],patch)};exports.diff3=function(){var args=getArgs(arguments);var r=[];exports.chunk(args,function(index,unstable){var mine=unstable[0];var insert=resolve(unstable);if(equal(mine,insert))return;r.push([index,mine.length].concat(insert))});return r};exports.oddOneOut=function oddOneOut(changes){changes=changes.slice();changes.unshift(changes.splice(1,1)[0]);var i=oddElement(changes,equal);if(i==0)return changes[1];if(~i)return changes[i]};exports.insertMergeOverDelete=function insertMergeOverDelete(changes){changes=changes.slice();changes.splice(1,1);for(var i=0,nonempty;i<changes.length;i++)if(changes[i].length)if(!nonempty)nonempty=changes[i];else return;return nonempty};var rules=deps&&deps.rules||[exports.oddOneOut,exports.insertMergeOverDelete];function resolve(changes){var l=rules.length;for(var i in rules){var c=rules[i]&&rules[i](changes);if(c)return c}changes.splice(1,1);return{"?":changes}}return exports};exports(null,exports)});require.define("/node_modules/r-array/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={}});require.define("/node_modules/r-array/index.js",function(require,module,exports,__dirname,__filename,process,global){var between=require("between");var Scuttlebutt=require("scuttlebutt");var inherits=require("util").inherits;var filter=require("scuttlebutt/util").filter;inherits(RArray,Scuttlebutt);module.exports=RArray;function fuzz(){return Math.random().toString().substring(2,5)}var DOEMIT=true,CHANGE={};function order(a,b){return between.strord(a[1],b[1])||between.strord(a[2],b[2])}function RArray(){Scuttlebutt.call(this);this.keys=[];this.store={};this._hist={};this.length=0;if(arguments.length){var self=this;[].forEach.call(arguments,function(e){self.push(e)})}}var A=RArray.prototype;A.last=function(){return this.keys[this.keys.length-1]};A.first=function(){return this.keys[0]};A.insert=function(before,val,after){var key=between(before||between.lo,after||between.hi)+fuzz();this.set(key,val);return key};A.push=function(val){var key=this.insert(this.last(),val)};A.unshift=function(val){var key=this.insert(null,val,this.first())};A.indexOf=function(val){for(var i in this.keys){var key=this.keys[i];if(v===this.get(key))return i}return null};A.indexOfKey=function(key){return this.keys.indexOf(key)};A.toJSON=function(){var store=this.store;var self=this;return this.keys.map(function(key){return self.get(key)})};A.set=function(key,val){if("string"==typeof key){if(val===null)return this.unset(key);if(null==this.store[key])this.length++;this.store[key]=val;if(!~this.keys.indexOf(key)){this.keys.push(key);this.keys.sort()}CHANGE[key]=val;DOEMIT&&this._emit()}};A.get=function(key){return this.store[key]};A.unset=function(key){if("string"==typeof key){if(null!=this.store[key])this.length--;delete this.store[key];var i=this.keys.indexOf(key);if(!~i)return;this.keys.splice(i,1);CHANGE[key]=null;DOEMIT&&this._emit()}};A.pop=function(){var l=this.last();var val=this.store[l];this.unset(l);return val};A.shift=function(){var f=this.first();var val=this.store[f];this.unset(f);return val};A._emit=function(){if(!DOEMIT)return;this.localUpdate(CHANGE);CHANGE={}};A.splice=function(i,d){var args=[].slice.call(arguments,2);var j=0,l=args.length;DOEMIT=false;if(d+i>this.keys.length)d=this.keys.length-i;while(j<d){if(j<l)this.set(this.keys[i+j],args[j]),j++;else this.unset(this.keys[i+j]),d--}while(j<l)this.insert(this.keys[i+j-1],args[j],this.keys[i+j]),j++;DOEMIT=true;this._emit()};A.applyUpdate=function(update){DOEMIT=false;var change=update[0],old;var apply={},ch={};var old={};for(var key in change){if(!this._hist[key]||order(update,this._hist[key])>0)apply[key]=change[key]}this.emit("preupdate",apply);for(var key in apply){var o=this._hist[key];o&&(old[o[1]+":"+o[2]]=o);this._hist[key]=update;this.set(key,apply[key])}for(var id in old){var o=old[id][0],rm=true;for(var key in o){if(this._hist[key]===old[id])rm=false}if(rm)this.emit("_remove",old[id])}DOEMIT=true;CHANGE={};this.emit("update",apply);return true};A.history=function(sources){var h=[];for(var key in this._hist){var update=this._hist[key];if(!~h.indexOf(update)&&filter(update,sources))h.push(update)}return h.sort(order)};A.forEach=function(fun){return this.toJSON().forEach(fun)};A.filter=function(fun){return this.toJSON().filter(fun)};A.map=function(fun){return this.toJSON().map(fun)};A.reduce=function(fun,initial){return this.toJSON().reduce(fun,initial)}});require.define("/node_modules/between/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={}});require.define("/node_modules/between/index.js",function(require,module,exports,__dirname,__filename,process,global){function inject(chars){chars=chars||"!0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~";chars=chars.split("").sort().join("");var exports=between;exports.between=between;exports.randstr=randstr;exports.between=between;exports.strord=strord;exports.lo=chars[0];exports.hi=chars[chars.length-1];exports.inject=inject;function randstr(l){var str="";while(l--)str+=chars[Math.floor(Math.random()*chars.length)];return str}function between(a,b){var s="",i=0;while(true){var _a=chars.indexOf(a[i]);var _b=chars.indexOf(b[i]);if(_a==-1)_a=0;if(_b==-1)_b=chars.length-1;i++;var c=chars[_a+1<_b?Math.round((_a+_b)/2):_a];s+=c;if(a<s&&s<b&&c!=exports.lo)return s}}function strord(a,b){return a==b?0:a<b?-1:1}between.strord;return between}module.exports=inject(null)});require.define("/node_modules/crdt/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={}});require.define("/node_modules/crdt/index.js",function(require,module,exports,__dirname,__filename,process,global){"use strict";var inherits=require("util").inherits;var EventEmitter=require("events").EventEmitter;exports=module.exports=require("./doc");exports.Row=require("./row");exports.sync=sync;exports.Set=require("./set");exports.Seq=require("./seq");exports.Doc=exports;function sync(a,b){var as=a.createStream();var bs=b.createStream();return as.pipe(bs).pipe(as)}exports.createStream=function(doc,opts){return doc.createStream(opts)}});require.define("/node_modules/crdt/doc.js",function(require,module,exports,__dirname,__filename,process,global){var inherits=require("util").inherits;var Row=require("./row");var between=require("between");var Set=require("./set");var Seq=require("./seq");var Scuttlebutt=require("scuttlebutt");var EventEmitter=require("events").EventEmitter;var createId=require("scuttlebutt/util").createId;inherits(Doc,Scuttlebutt);function merge(to,from){for(var k in from)to[k]=from[k];return to}module.exports=Doc;function order(a,b){return between.strord(a[1],b[1])||between.strord(a[2],b[2])}function Doc(id){this.rows={};this.hist={};this.recieved={};this.sets=new EventEmitter;this.setMaxListeners(Infinity);this.sets.setMaxListeners(Infinity);Scuttlebutt.call(this,id)}Doc.prototype.add=function(initial){var id=initial.id===undefined?createId():initial.id;var r=this._add(id,"local");r._set(initial,"local");return r};Doc.prototype._add=function(id,source,change){var doc=this;if(this.rows[id])return this.rows[id];var r=id instanceof Row?id:new Row(id);this.rows[r.id]=r;function track(changes,source){doc.localUpdate([r.id,changes])}r.on("preupdate",track);r._new=true;return r};Doc.prototype.timeUpdated=function(row,key){var h=this.hist[row.id];if(!h)return;return h[key][2]};Doc.prototype.set=function(id,change){var r=this._add(id,"local",change);return r.set(change)};Doc.prototype.applyUpdate=function(update,source){var id=update[0][0];var changes=update[0][1];var timestamp=update[1];var from=update[2];var changed={};var row=this._add(id,source);var hist=this.hist[id]=this.hist[id]||{};var emit=false,oldnews=false;for(var key in changes){var value=changes[key];if(!hist[key]||order(hist[key],update)<0){if(hist[key])this.emit("_remove",hist[key]);hist[key]=update;changed[key]=changes[key];emit=true}}merge(row.state,changed);for(var k in changed)this.sets.emit(k,row,changed);if(!emit)return;if(row._new){this.emit("add",row);this.emit("create",row);row._new=false}this.emit("_update",update);row.emit("update",update,changed);row.emit("changes",changes,changed);row.emit("change",changed);this.emit("update",update,source);this.emit("row_update",row)};Doc.prototype.history=function(sources){var h=[];for(var id in this.hist){var hist=this.hist[id];for(var k in hist){if(!~h.indexOf(hist[k])&&Scuttlebutt.filter(hist[k],sources))h.push(hist[k])}}return h.sort(order)};function _set(self,key,val,type){var id=key+":"+val;if(self.sets[id])return self.sets[id];return self.sets[key+":"+val]=new type(self,key,val)}Doc.prototype.createSet=function(key,val){return _set(this,key,val,Set)};Doc.prototype.createSeq=function(key,val){return _set(this,key,val,Seq)};Doc.prototype.toJSON=function(){var j={};for(var k in this.rows)j[k]=this.rows[k].state;return j};Doc.prototype.get=function(id){return this.rows[id]=this.rows[id]||this._add(new Row(id),"local")}});require.define("/node_modules/crdt/row.js",function(require,module,exports,__dirname,__filename,process,global){"use strict";var inherits=require("util").inherits;var EventEmitter=require("events").EventEmitter;module.exports=Row;inherits(Row,EventEmitter);function Row(id){this.id=id;this.state={id:id};this.setMaxListeners(Infinity)}Row.prototype.set=function(changes,v){if(arguments.length==2){var k=changes;changes={};changes[k]=v}if(changes.id&&changes.id!==this.state.id)throw new Error("id cannot be changed");this._set(changes,"local");return this};Row.prototype.validate=function(changes){try{this.emit("validate",changes);return true}catch(e){console.error("validation",e.message);return false}};Row.prototype._set=function(changes,source){this.emit("preupdate",changes,source);return this};Row.prototype.get=function(key){if(key)return this.state[key];return this.state};Row.prototype.toJSON=function(){return this.state}});require.define("/node_modules/crdt/set.js",function(require,module,exports,__dirname,__filename,process,global){"use strict";var inherits=require("util").inherits;var EventEmitter=require("events").EventEmitter;var Row=require("./row");var between=require("between");inherits(Set,EventEmitter);module.exports=Set;function Set(doc,key,value){var array=this._array=[];var rows=this.rows={};var set=this;this.key=key;this.value=value;function add(row){array.push(row);rows[row.id]=row;set.emit("add",row);function remove(_,changed){if(row.state[key]===value){set.emit("changes",row,changed);return}delete rows[row.id];var i=array.indexOf(row);if(~i)array.splice(i,1);set.emit("changes",row,changed);set.emit("remove",row);row.removeListener("changes",remove)}row.on("changes",remove)}doc.sets.on(key,function(row,changed){if(changed[key]!==value)return;add(row)});this.rm=this.remove=function(row){row=this.get(row);if(!row)return;return row.set(key,null)};for(var id in doc.rows){var row=doc.get(id);if(row.get(key)===value)add(row)}this.setMaxListeners(Infinity)}Set.prototype.asArray=function(){return this._array};Set.prototype.toJSON=function(){return this._array.map(function(e){return e.state}).sort(function(a,b){return between.strord(a._sort||a.id,b._sort||b.id)})};Set.prototype.each=Set.prototype.forEach=function(iter){return this._array.forEach(iter)};Set.prototype.get=function(id){if(!arguments.length)return this.array;
return"string"===typeof id?this.rows[id]:"number"===typeof id?this.rows[id]:id&&id.id?this.rows[id.id]:null};Set.prototype.has=function(row){return this.get(row)}});require.define("/node_modules/crdt/seq.js",function(require,module,exports,__dirname,__filename,process,global){"use strict";var Set=require("./set");var Row=require("./row");var inherits=require("util").inherits;var between=require("between");module.exports=Seq;function sort(array){return array.sort(function(a,b){return between.strord(a.get("_sort"),b.get("_sort"))})}inherits(Seq,Set);function find(obj,iter){for(var k in obj){var v=obj[k];if(iter(v,k,obj))return v}return null}function Seq(doc,key,val){Set.call(this,doc,key,val);var seq=this;this.on("changes",function(row,changes){if(!changes._sort)return;sort(seq._array);var prev=find(seq._array,function(other){return other!=row&&other.get("_sort")==row.get("_sort")});if(prev)seq.insert(row,prev,seq.next(row));else seq.emit("move",row)});this.insert=function(obj,before,after){before=toKey(this.get(before)||"!");after=toKey(this.get(after)||"~");if("string"===typeof obj)obj=doc.rows[obj];var _sort=between.between(before,after)+between.randstr(3);var r,changes;if(obj instanceof Row){r=obj;changes={_sort:_sort};if(r.get(key)!=val)changes[key]=val;r.set(changes)}else{obj._sort=_sort;obj[key]=val;r=doc.set(id(obj),obj)}sort(this._array);return r}}function toKey(key){return"string"===typeof key?key:key instanceof Row?key.get()._sort:key?key._sort:null}function max(ary,test,wantIndex){var max=null,_max=-1;if(!ary.length)return;for(var i=0;i<ary.length;i++)if(test(max,ary[i]))max=ary[_max=i];return wantIndex?_max:max}Seq.prototype.prev=function(key){key=toKey(this.get(key)||"~");return max(this._array,function(M,m){if(toKey(m)<key)return M?toKey(m)>toKey(M):true})};Seq.prototype.next=function(key){key=toKey(this.get(key)||"!");return max(this._array,function(M,m){if(toKey(m)>key)return M?toKey(m)<toKey(M):true})};function id(obj){return obj.id||obj._id||"_"+Date.now()+"_"+Math.round(Math.random()*1e3)}Seq.prototype.before=function(obj,before){return this.insert(obj,this.prev(before),before)};Seq.prototype.after=function(obj,after){return this.insert(obj,after,this.next(after))};Seq.prototype.first=function(){return this._array[0]};Seq.prototype.last=function(){return this._array[this._array.length-1]};Seq.prototype.indexOf=function(obj){return this._array.indexOf("string"==typeof obj?this.rows[obj]:obj)};Seq.prototype.at=function(i){return this._array[i]};Seq.prototype.unshift=function(obj){return this.insert(obj,"!",this.first())};Seq.prototype.push=function(obj){return this.insert(obj,this.last(),"~")};Seq.prototype.length=function(){return this._array.length};Seq.prototype.pop=function(){return this.remove(this.last())};Seq.prototype.shift=function(){return this.remove(this.first())}});require.define("/node_modules/append-only/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={main:"index"}});require.define("/node_modules/append-only/index.js",function(require,module,exports,__dirname,__filename,process,global){var Scuttlebutt=require("scuttlebutt"),filter=Scuttlebutt.filter,inherits=require("util").inherits;inherits(AppendOnly,Scuttlebutt);var proto=AppendOnly.prototype;proto.push=push;proto.remove=remove;proto.applyUpdate=applyUpdate;proto.history=history;proto.toJSON=proto.createArray=createArray;module.exports=AppendOnly;function AppendOnly(options){if(!(this instanceof AppendOnly)){return new AppendOnly(options)}Scuttlebutt.call(this,options);var store=this._store=[];this._hash={};this.on("_remove",function(update,update2){var index=store.indexOf(update);if(index!==-1){store.splice(index,1)}index=store.indexOf(update2);if(index!==-1){store.splice(index,1)}})}function push(item){this.localUpdate({push:item})}function remove(id){this.localUpdate({remove:id.__id?id.__id:id})}function toId(update){var ts=update[1],source=update[2];return source+":"+ts}function applyUpdate(update){var value=update[0];this._store.push(update);if(value.push){var item=value.push,id=toId(update);Object.defineProperty(item,"__id",{value:id,configurable:true});this._hash[id]=update;this.emit("item",item)}else if(value.remove){var id=value.remove,_update=this._hash[id];delete this._hash[id];this.emit("_remove",_update,update);this.emit("remove",_update[0].push)}return true}function history(sources){return this._store.filter(function(update){return filter(update,sources)})}function createArray(){var hash=this._hash;return Object.keys(hash).map(findKey,hash)}function findKey(key){return this[key][0].push}});require.define("/node_modules/expiry-model/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={main:"index"}});require.define("/node_modules/expiry-model/index.js",function(require,module,exports,__dirname,__filename,process,global){var Scuttlebutt=require("scuttlebutt");var extend=require("xtend");var LRU=require("lru-cache");var filter=Scuttlebutt.filter;var DAY=1e3*60*60*24;var defaults={max:500,maxAge:DAY};module.exports=ExpiryModel;function ExpiryModel(options){options=extend({},defaults,options||{});if(!options.dispose){options.dispose=dispose}var scuttle=Scuttlebutt();var maxAge=options.maxAge;var store=LRU(options);scuttle.set=set;scuttle.get=get;scuttle.applyUpdate=applyUpdate;scuttle.toJSON=toJSON;scuttle.history=history;return scuttle;function dispose(key,value){var source=value[2];var found=false;store.forEach(function(record){if(record[2]===source&&record[1]!==value[1]){found=true}});if(!found){delete scuttle.sources[source]}}function set(key,value){scuttle.localUpdate([key,value])}function get(key){var record=store.get(key);return record?record[0][1]:null}function getMergedRecord(update){var transaction=update[0];var key=transaction[0];var current=store.get(key);if(!current){return update.slice()}var currentValue=current[0][1];var currentTs=current[1];var value=transaction[1];var ts=update[1];if(typeof currentValue==="object"&&typeof value==="object"&&value!==null){if(currentTs>ts){value=extend({},value,currentValue)}else{value=extend({},currentValue,value)}}else if(currentTs>ts){return false}return[[key,value],ts,update[2]]}function applyUpdate(update){var ts=update[1];var key=update[0][0];if(ts<=Date.now()-maxAge){return false}var record=getMergedRecord(update);if(record===false){return false}else if(record[0][1]===null){store.del(key)}else{store.set(key,record)}scuttle.emit("update",record[0][0],record[0][1],record[1],record[2]);return true}function toJSON(){var hash={};store.forEach(function(record,key){hash[key]=record[0][1]});return hash}function history(sources){sources=sources||{};var list=[];var now=Date.now();store.forEach(function(record,key){var ts=record[1];if(ts>now-maxAge){if(filter(record,sources)){list.push(record)}}else{store.del(key)}});return list.sort(function(a,b){if(a[2]!==b[2]){return 0}return a[1]<b[1]?-1:1})}}});require.define("/node_modules/expiry-model/node_modules/lru-cache/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={main:"lib/lru-cache.js"}});require.define("/node_modules/expiry-model/node_modules/lru-cache/lib/lru-cache.js",function(require,module,exports,__dirname,__filename,process,global){(function(){if(typeof module==="object"&&module.exports){module.exports=LRUCache}else{this.LRUCache=LRUCache}function hOP(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)}function naiveLength(){return 1}function LRUCache(options){if(!(this instanceof LRUCache)){return new LRUCache(options)}var max;if(typeof options==="number"){max=options;options={max:max}}if(!options)options={};max=options.max;var lengthCalculator=options.length||naiveLength;if(typeof lengthCalculator!=="function"){lengthCalculator=naiveLength}if(!max||!(typeof max==="number")||max<=0){max=Infinity}var allowStale=options.stale||false;var maxAge=options.maxAge||null;var dispose=options.dispose;var cache=Object.create(null),lruList=Object.create(null),mru=0,length=0,itemCount=0;Object.defineProperty(this,"max",{set:function(mL){if(!mL||!(typeof mL==="number")||mL<=0)mL=Infinity;max=mL;if(length>max)trim()},get:function(){return max},enumerable:true});Object.defineProperty(this,"lengthCalculator",{set:function(lC){if(typeof lC!=="function"){lengthCalculator=naiveLength;length=itemCount;for(var key in cache){cache[key].length=1}}else{lengthCalculator=lC;length=0;for(var key in cache){cache[key].length=lengthCalculator(cache[key].value);length+=cache[key].length}}if(length>max)trim()},get:function(){return lengthCalculator},enumerable:true});Object.defineProperty(this,"length",{get:function(){return length},enumerable:true});Object.defineProperty(this,"itemCount",{get:function(){return itemCount},enumerable:true});this.forEach=function(fn,thisp){thisp=thisp||this;var i=0;for(var k=mru-1;k>=0&&i<itemCount;k--)if(lruList[k]){i++;var hit=lruList[k];fn.call(thisp,hit.value,hit.key,this)}};this.keys=function(){var keys=new Array(itemCount);var i=0;for(var k=mru-1;k>=0&&i<itemCount;k--)if(lruList[k]){var hit=lruList[k];keys[i++]=hit.key}return keys};this.values=function(){var values=new Array(itemCount);var i=0;for(var k=mru-1;k>=0&&i<itemCount;k--)if(lruList[k]){var hit=lruList[k];values[i++]=hit.value}return values};this.reset=function(){if(dispose){for(var k in cache){dispose(k,cache[k].value)}}cache={};lruList={};mru=0;length=0;itemCount=0};this.dump=function(){return cache};this.dumpLru=function(){return lruList};this.set=function(key,value){if(hOP(cache,key)){if(dispose)dispose(key,cache[key].value);if(maxAge)cache[key].now=Date.now();cache[key].value=value;this.get(key);return true}var len=lengthCalculator(value);var age=maxAge?Date.now():0;var hit=new Entry(key,value,mru++,len,age);if(hit.length>max){if(dispose)dispose(key,value);return false}length+=hit.length;lruList[hit.lu]=cache[key]=hit;itemCount++;if(length>max)trim();return true};this.has=function(key){if(!hOP(cache,key))return false;var hit=cache[key];if(maxAge&&Date.now()-hit.now>maxAge){return false}return true};this.get=function(key){if(!hOP(cache,key))return;var hit=cache[key];if(maxAge&&Date.now()-hit.now>maxAge){this.del(key);return allowStale?hit.value:undefined}delete lruList[hit.lu];hit.lu=mru++;lruList[hit.lu]=hit;return hit.value};this.del=function(key){if(!hOP(cache,key))return;var hit=cache[key];if(dispose)dispose(key,hit.value);delete cache[key];delete lruList[hit.lu];length-=hit.length;itemCount--};function trim(){if(length<=max)return;for(var k in lruList){if(length<=max)break;var hit=lruList[k];if(dispose)dispose(hit.key,hit.value);length-=hit.length;delete cache[hit.key];delete lruList[k]}}}function Entry(key,value,mru,len,age){this.key=key;this.value=value;this.lu=mru;this.length=len;this.now=age}})()});require.define("/rumours.js",function(require,module,exports,__dirname,__filename,process,global){module.exports=window.Rumours=require("./client")});require("/rumours.js")})();